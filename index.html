<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>BebCom Delivery - Pedido Online</title>
    
    <!-- SEO -->
    <meta name="description" content="BebCom Delivery - Bebidas, drinks e muito mais. Pe√ßa pelo WhatsApp!">
    <meta name="keywords" content="delivery, bebidas, drinks, cerveja, whisky, gin, vodka, bauru, salgadinhos, doces">
    <meta name="author" content="BebCom Delivery">
    
    <!-- PWA -->
    <meta name="theme-color" content="#dc2626">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Open Graph -->
    <meta property="og:title" content="BebCom Delivery">
    <meta property="og:description" content="Seu delivery de bebidas em Bauru">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/og-image.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçπ</text></svg>">
    
    <!-- Mercado Pago SDK -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    
    <style>
        /* ====== SEUS ESTILOS EXATAMENTE IGUAIS - NADA MUDOU ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #dc2626;
            --primary-dark: #b91c1c;
            --secondary: #4d96ff;
            --secondary-dark: #3b82f6;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --dark: #0a0a0a;
            --darker: #1a1a1a;
            --light: #f5f5f5;
            --gray: #94a3b8;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        body {
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            padding-bottom: 30px;
            line-height: 1.5;
        }

        .header {
            background: linear-gradient(135deg, #000000 0%, var(--darker) 100%);
            color: white;
            text-align: center;
            padding: 20px 15px;
            font-size: clamp(24px, 5vw, 28px);
            font-weight: 800;
            letter-spacing: 1px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            gap: 8px;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            position: sticky;
            top: 70px;
            z-index: 99;
            border-bottom: 1px solid #333;
        }

        .nav-container::-webkit-scrollbar {
            height: 3px;
        }

        .nav-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .nav-button {
            padding: 12px 18px;
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid #444;
            border-radius: 30px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .nav-button:hover {
            background: rgba(220, 38, 38, 0.9);
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .main-container {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        .menu-section, .cart-section {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #333;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease;
        }

        .cart-section {
            position: sticky;
            top: 140px;
            max-height: calc(100vh - 160px);
            overflow-y: auto;
        }

        @media (max-width: 1024px) {
            .cart-section {
                position: static;
                max-height: none;
            }
        }

        .section-title {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: clamp(20px, 4vw, 24px);
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 30px;
        }

        .category-button {
            background: linear-gradient(135deg, rgba(45, 45, 45, 0.95) 0%, rgba(60, 60, 60, 0.95) 100%);
            border: 1px solid #444;
            padding: 20px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: white;
            transition: all 0.2s ease;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.2);
            border-color: var(--primary);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }

        .product-card {
            background: rgba(45, 45, 45, 0.8);
            border: 1px solid #444;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
            backdrop-filter: blur(5px);
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 25px rgba(220, 38, 38, 0.15);
            border-color: var(--primary);
        }

        .product-card.unavailable {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.8);
        }

        .product-card.unavailable::after {
            content: "INDISPON√çVEL";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 38, 38, 0.95);
            color: white;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 700;
            z-index: 2;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .product-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: white;
            line-height: 1.3;
        }

        .product-info {
            font-size: 13px;
            color: var(--gray);
            margin-bottom: 12px;
            flex: 1;
        }

        .product-price {
            font-size: 20px;
            color: var(--primary);
            font-weight: 800;
            text-align: right;
            margin-top: 10px;
        }

        .flavor-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(77, 150, 255, 0.2);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }

        .add-to-cart-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .add-to-cart-btn.has-flavors {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
        }

        .add-to-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
        }

        .add-to-cart-btn.added {
            background: linear-gradient(135deg, var(--success) 0%, #218838 100%);
        }

        .add-to-cart-btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.7;
            transform: none !important;
            box-shadow: none !important;
        }

        .cart-items {
            max-height: 350px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }

        .cart-items::-webkit-scrollbar {
            width: 4px;
        }

        .cart-items::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(45, 45, 45, 0.6);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid #444;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quantity-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            transition: all 0.2s;
        }

        .quantity-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .remove-item-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 16px;
            padding: 6px 10px;
            border-radius: 6px;
            margin-left: 8px;
        }

        .remove-item-btn:hover {
            background: rgba(220, 53, 69, 0.1);
        }

        .totals-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #444;
            font-size: 15px;
        }

        .grand-total {
            font-size: 20px;
            font-weight: 800;
            color: var(--warning);
            border-bottom: none;
            padding-top: 12px;
            border-top: 2px solid #555;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            color: #ddd;
            font-weight: 600;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid #444;
            border-radius: 10px;
            color: white;
            font-size: 15px;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 3px rgba(77, 150, 255, 0.1);
        }

        .form-input::placeholder {
            color: #666;
        }

        .delivery-options {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .delivery-option {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: rgba(45, 45, 45, 0.6);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .delivery-option.selected {
            border-color: var(--secondary);
            background: rgba(77, 150, 255, 0.15);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .payment-method {
            padding: 15px;
            background: rgba(45, 45, 45, 0.6);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .payment-method.selected {
            border-color: var(--secondary);
            background: rgba(77, 150, 255, 0.15);
        }

        .payment-icon {
            font-size: 28px;
            margin-bottom: 6px;
        }

        .primary-button {
            background: linear-gradient(135deg, var(--success) 0%, #218838 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            width: 100%;
            transition: all 0.2s ease;
            margin: 12px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .primary-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.4);
        }

        .primary-button:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .secondary-button {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            transition: all 0.2s;
            margin: 12px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .secondary-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4);
        }

        .secondary-button:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .clear-button {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            width: 100%;
            margin-top: 12px;
            transition: all 0.2s;
            font-weight: 600;
        }

        .clear-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
        }

        .payment-status {
            padding: 16px;
            border-radius: 12px;
            margin: 15px 0;
            background: rgba(255, 217, 61, 0.1);
            border-left: 5px solid var(--warning);
            font-size: 15px;
            text-align: center;
            animation: fadeIn 0.3s ease;
        }

        .payment-status.success {
            background: rgba(40, 167, 69, 0.1);
            border-left-color: var(--success);
        }

        .payment-status.error {
            background: rgba(220, 53, 69, 0.1);
            border-left-color: var(--danger);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        .flavor-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 20000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .flavor-modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 550px;
            max-height: 85vh;
            overflow-y: auto;
            border: 2px solid var(--secondary);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
            animation: fadeIn 0.4s ease;
        }

        .flavor-modal-title {
            color: var(--secondary);
            text-align: center;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .flavors-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .flavor-option {
            padding: 16px 12px;
            background: rgba(45, 45, 45, 0.7);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
        }

        .flavor-option:hover {
            background: rgba(77, 150, 255, 0.2);
            transform: translateY(-3px);
        }

        .flavor-option.selected {
            border-color: var(--warning);
            background: rgba(255, 217, 61, 0.15);
        }

        .flavor-option.unavailable {
            opacity: 0.5;
            pointer-events: none;
            position: relative;
        }

        .age-verification-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 99999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(15px);
        }

        .age-modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border-radius: 24px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid var(--primary);
            box-shadow: 0 25px 70px rgba(0,0,0,0.9);
        }

        .age-modal-header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            padding: 25px 30px;
            border-bottom: 2px solid var(--primary);
            text-align: center;
        }

        .age-modal-header h2 {
            color: white;
            font-size: 28px;
            margin: 0;
            font-weight: 800;
        }

        .age-legal-text {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 16px;
            border-left: 5px solid var(--secondary);
            margin: 20px 0;
        }

        .age-checkbox-container {
            background: rgba(220, 38, 38, 0.1);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--primary);
            margin-top: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .age-checkbox-container input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-top: 3px;
            accent-color: var(--success);
            cursor: pointer;
        }

        .age-modal-footer {
            padding: 20px 30px;
            display: flex;
            gap: 20px;
            border-top: 1px solid #444;
        }

        .age-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .age-btn-exit {
            background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);
            color: white;
        }

        .age-btn-enter {
            background: linear-gradient(135deg, var(--success) 0%, #218838 100%);
            color: white;
        }

        .age-btn-enter:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .admin-button {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
            transition: all 0.2s;
        }

        .admin-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.7);
        }

        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 10001;
            overflow-y: auto;
            padding: 20px;
        }

        .admin-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            max-width: 1200px;
            margin: 30px auto;
            border-radius: 20px;
            border: 2px solid var(--secondary);
            overflow: hidden;
        }

        .admin-header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            padding: 20px 30px;
            border-bottom: 2px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 24px;
            font-weight: 800;
            color: #60a5fa;
        }

        .admin-close {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .admin-close:hover {
            transform: scale(1.1);
            background: #b91c1c;
        }

        .admin-password {
            padding: 30px;
        }

        .password-input {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .password-input:focus {
            outline: none;
            border-color: var(--secondary);
            background: rgba(255,255,255,0.15);
        }

        .password-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .password-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .admin-actions {
            padding: 20px 30px;
            background: rgba(26, 26, 26, 0.8);
            border-top: 1px solid #333;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .admin-action-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .admin-action-btn:hover {
            transform: translateY(-2px);
        }

        .all-btn { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .none-btn { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .save-btn { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .reset-btn { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .nav-container { padding: 10px; }
            .nav-button { padding: 10px 16px; font-size: 13px; }
            .categories-grid { grid-template-columns: repeat(2, 1fr); }
            .products-grid { grid-template-columns: 1fr; }
            .payment-methods { grid-template-columns: 1fr; }
            .delivery-options { flex-direction: column; }
            .flavors-grid { grid-template-columns: 1fr; }
            .age-modal-footer { flex-direction: column; }
            .age-modal-header h2 { font-size: 22px; }
            .admin-header { flex-direction: column; gap: 15px; text-align: center; }
            .admin-actions { flex-direction: column; }
            .admin-action-btn { width: 100%; }
        }

        @media (max-width: 480px) {
            .header { font-size: 20px; padding: 15px; }
            .section-title { font-size: 20px; }
            .product-card { padding: 15px; }
            .product-price { font-size: 18px; }
            .cart-item { flex-direction: column; align-items: flex-start; gap: 12px; }
            .flavor-modal-content { padding: 20px; }
            .admin-title { font-size: 20px; }
        }

        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <!-- Bot√£o Admin -->
    <button class="admin-button" id="adminButton" title="Painel Administrativo">üîß</button>

    <!-- MODAL DE VERIFICA√á√ÉO DE IDADE -->
    <div class="age-verification-modal" id="ageVerificationModal">
        <div class="age-modal-content">
            <div class="age-modal-header">
                <h2>üçπ Verifica√ß√£o de Idade</h2>
            </div>
            <div class="age-modal-body" style="padding: 30px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="font-size: 60px;">‚ö†Ô∏è</span>
                </div>
                <div class="age-legal-text">
                    <p><strong>DECLARA√á√ÉO LEGAL</strong></p>
                    <p>Conforme o <strong>Estatuto da Crian√ßa e do Adolescente (Lei 8.069/90)</strong>, a venda de bebidas alco√≥licas a menores de 18 anos √© proibida.</p>
                    <p>Este site √© destinado exclusivamente a maiores de 18 anos.</p>
                    
                    <div class="age-checkbox-container">
                        <input type="checkbox" id="ageConfirmationCheckbox">
                        <label for="ageConfirmationCheckbox">
                            <strong>DECLARO</strong> que tenho 18 anos ou mais e assumo total responsabilidade por esta declara√ß√£o.
                        </label>
                    </div>
                </div>
            </div>
            <div class="age-modal-footer">
                <button class="age-btn age-btn-exit" onclick="window.location.href='https://www.google.com'">
                    ‚ùå Sair
                    <small style="font-size: 12px;">Menor de 18 anos</small>
                </button>
                <button class="age-btn age-btn-enter" id="enterSiteButton" disabled>
                    ‚úÖ Entrar
                    <small style="font-size: 12px;">Sou maior de 18 anos</small>
                </button>
            </div>
            <div class="age-modal-disclaimer" style="padding: 15px 30px; background: rgba(0,0,0,0.3); text-align: center; color: #94a3b8; font-size: 12px;">
                BebCom Delivery - Consumo moderado. Beba com responsabilidade.
            </div>
        </div>
    </div>

    <div class="header">
        üçπ BEBCOM DELIVERY
    </div>

    <div class="nav-container">
        <button class="nav-button" onclick="showCategory('drinks-whisky')">ü•É Drinks Whisky</button>
        <button class="nav-button" onclick="showCategory('drinks-gin')">üç∏ Drinks Gin</button>
        <button class="nav-button" onclick="showCategory('drinks-vodka')">üç∏ Drinks Vodka</button>
        <button class="nav-button" onclick="showCategory('drinks-vinho')">üç∑ Drinks Vinho</button>
        <button class="nav-button" onclick="showCategory('cervejas')">üç∫ Cervejas</button>
        <button class="nav-button" onclick="showCategory('destilados')">ü•É Destilados</button>
        <button class="nav-button" onclick="showCategory('aguas')">üíß √Åguas</button>
        <button class="nav-button" onclick="showCategory('refri-latas')">ü•§ Refri Latas</button>
        <button class="nav-button" onclick="showCategory('refri-pet')">ü•§ Refri PET</button>
        <button class="nav-button" onclick="showCategory('sucos')">üßÉ Sucos</button>
        <button class="nav-button" onclick="showCategory('energeticos')">‚ö° Energ√©ticos</button>
        <button class="nav-button" onclick="showCategory('gelo-carvao')">üßä Gelo/Carv√£o</button>
        <button class="nav-button" onclick="showCategory('salgadinhos')">ü•® Salgadinhos</button>
        <button class="nav-button" onclick="showCategory('doces')">üç¨ Doces</button>
    </div>

    <div class="main-container">
        <!-- CARD√ÅPIO -->
        <div class="menu-section">
            <h2 class="section-title">üìã Card√°pio</h2>
            <div class="categories-grid" id="categoriesGrid"></div>
            <div class="products-grid" id="productsGrid">
                <div style="text-align: center; color: #aaa; padding: 50px; grid-column: 1/-1;">
                    üçπ Selecione uma categoria para ver os produtos
                </div>
            </div>
        </div>

        <!-- CARRINHO -->
        <div class="cart-section">
            <h2 class="section-title">üõí Carrinho</h2>
            
            <div class="cart-items" id="cartItems">
                <div style="text-align: center; color: #aaa; padding: 40px;">
                    Seu carrinho est√° vazio
                </div>
            </div>

            <div class="totals-section">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span>R$ <span id="subtotal">0.00</span></span>
                </div>
                <div class="total-row" id="deliveryRow" style="display: none;">
                    <span>Taxa de Entrega:</span>
                    <span>R$ <span id="deliveryFee">0.00</span></span>
                </div>
                <div class="total-row grand-total">
                    <span>Total:</span>
                    <span>R$ <span id="totalAmount">0.00</span></span>
                </div>
            </div>

            <!-- Dados do Cliente -->
            <div class="customer-section">
                <div class="form-group">
                    <label class="form-label">üë§ Nome Completo *</label>
                    <input type="text" class="form-input" id="customerName" placeholder="Digite seu nome" autocomplete="name">
                </div>
                <div class="form-group">
                    <label class="form-label">üì± WhatsApp *</label>
                    <input type="tel" class="form-input" id="customerPhone" placeholder="(14) 99999-9999" autocomplete="tel">
                </div>
            </div>

            <!-- Tipo de Pedido -->
            <div class="delivery-section">
                <label class="form-label">üì¶ Tipo de Pedido</label>
                <div class="delivery-options">
                    <div class="delivery-option selected" onclick="selectDeliveryType('pickup')">üè™ Retirada</div>
                    <div class="delivery-option" onclick="selectDeliveryType('delivery')">üöö Entrega</div>
                </div>

                <div id="addressFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">üìç Endere√ßo *</label>
                        <div style="display: grid; grid-template-columns: 3fr 1fr; gap: 10px;">
                            <input type="text" class="form-input" id="street" placeholder="Rua/Avenida">
                            <input type="text" class="form-input" id="number" placeholder="N¬∫">
                        </div>
                    </div>
                    <div class="form-group">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px;">
                            <input type="text" class="form-input" id="neighborhood" placeholder="Bairro">
                            <input type="text" class="form-input" id="city" placeholder="Cidade" value="Bauru">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üè† Complemento</label>
                        <input type="text" class="form-input" id="addressComplement" placeholder="Apto, Bloco, Refer√™ncia">
                    </div>
                </div>
            </div>

            <!-- Pagamento -->
            <div class="payment-section">
                <label class="form-label" id="paymentLabel" style="display: none;">üí≥ Pagamento</label>
                <div class="payment-methods" id="paymentMethods" style="display: none;">
                    <div class="payment-method selected" onclick="selectPaymentMethod('pix')">
                        <div class="payment-icon">üßæ</div>
                        <div>PIX</div>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('card_online')">
                        <div class="payment-icon">üí≥</div>
                        <div>Cart√£o</div>
                    </div>
                </div>

                <div id="paymentStatus" class="payment-status" style="display: none;"></div>

                <button class="primary-button" id="payButton" disabled onclick="processPayment()">
                    üí∞ Realizar Pagamento
                </button>

                <button class="secondary-button" id="whatsappButton" disabled onclick="sendToWhatsApp()">
                    üì± Enviar Pedido
                </button>

                <button class="clear-button" onclick="clearCart()">
                    üóëÔ∏è Limpar Carrinho
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE SABORES -->
    <div class="flavor-modal-overlay" id="flavorModal">
        <div class="flavor-modal-content">
            <h2 class="flavor-modal-title" id="flavorModalTitle">Escolha o sabor</h2>
            <div style="text-align: center; color: #aaa; margin-bottom: 20px;" id="flavorModalInstruction">
                Selecione uma op√ß√£o
            </div>
            <div class="flavors-grid" id="flavorsGrid"></div>
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button class="modal-button confirm" id="confirmFlavorButton" onclick="confirmFlavorSelection()" style="flex: 1; padding: 16px; background: linear-gradient(135deg, #28a745 0%, #218838 100%); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">
                    ‚úÖ Confirmar
                </button>
                <button class="modal-button cancel" onclick="cancelFlavorSelection()" style="flex: 1; padding: 16px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL ADMINISTRATIVO -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-content">
            <div class="admin-header">
                <h2 class="admin-title">üîß Gerenciamento</h2>
                <button class="admin-close" id="adminClose">√ó</button>
            </div>

            <div class="admin-password" id="passwordSection">
                <h3 style="color: #60a5fa; margin-bottom: 20px; text-align: center;">üîê Acesso Administrativo</h3>
                <input type="password" class="password-input" id="adminPassword" placeholder="Digite a senha">
                <button class="password-button" onclick="checkAdminPassword()">
                    Entrar
                </button>
            </div>

            <div class="admin-main" id="adminMain" style="display: none; padding: 20px 30px; max-height: 60vh; overflow-y: auto;">
                <!-- Categorias ser√£o carregadas dinamicamente -->
            </div>

            <div class="admin-actions" id="adminActions" style="display: none;">
                <button class="admin-action-btn all-btn" onclick="setAllAvailable(true)">‚úÖ Todos Dispon√≠vel</button>
                <button class="admin-action-btn none-btn" onclick="setAllAvailable(false)">‚ùå Todos Indispon√≠vel</button>
                <button class="admin-action-btn save-btn" onclick="saveAvailability()">üíæ Salvar no Servidor</button>
                <button class="admin-action-btn reset-btn" onclick="resetAvailability()">üîÑ Restaurar Padr√£o</button>
                <button class="admin-action-btn" onclick="openFlavorManagement()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">üçπ Gerenciar Sabores</button>
                <button class="admin-action-btn" onclick="syncAllFromServer()" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">üîÑ Sincronizar do Servidor</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ÉO INICIAL (SEGURA)
        // ============================================
        let CONFIG = {
            backendUrl: 'https://bebcom-delivery-api-1980-bchkauhjf0djajag.brazilsouth-01.azurewebsites.net',
            whatsappNumber: '5514996130369',
            mercadoPago: {
                publicKey: null,
                testMode: true
            },
            storeLocation: {
                lat: -22.35892,
                lng: -49.0987233,
                address: "R. Jos√© Henrique Ferraz, 18-10 - Centro, Bauru - SP"
            },
            deliveryRates: {
                baseFee: 5.00,
                perKm: 2.65,
                maxDistance: 15,
                minDistance: 0.5,
                freeDeliveryMin: 100.00
            },
            version: '3.5.0-azure-secure',
            environment: 'production'
        };

        // ============================================
        // DADOS DOS PRODUTOS (FONTE √öNICA DA VERDADE)
        // ============================================
        const products = {
            'drinks-whisky': [
                { id: 'old-star', name: 'Cop√£o Old Star', description: 'Drink cl√°ssico de whisky', price: 11.00, requiresFlavorSelection: true, flavorType: 'whisky_oldstar', nextStep: 'ice' },
                { id: 'passport', name: 'Cop√£o Passport', description: 'Whisky importado', price: 20.00, requiresFlavorSelection: true, flavorType: 'whisky_sem_sabor', nextStep: 'ice' },
                { id: 'natu-nobilis', name: 'Cop√£o Natu Nobilis', description: 'Whisky premium', price: 19.00, requiresFlavorSelection: true, flavorType: 'whisky_sem_sabor', nextStep: 'ice' },
                { id: 'white-horse', name: 'Cop√£o White Horse', description: 'Whisky escoc√™s', price: 24.00, requiresFlavorSelection: true, flavorType: 'whisky_sem_sabor', nextStep: 'ice' },
                { id: 'red-label', name: 'Cop√£o Red Label', description: 'Johnnie Walker', price: 28.00, requiresFlavorSelection: true, flavorType: 'whisky_sem_sabor', nextStep: 'ice' },
                { id: 'ballantines', name: 'Cop√£o Ballantines', description: 'Whisky escoc√™s', price: 30.00, requiresFlavorSelection: true, flavorType: 'whisky_sem_sabor', nextStep: 'ice' },
                { id: 'jack-daniels', name: 'Cop√£o Jack Daniels', description: 'Whisky americano', price: 40.00, requiresFlavorSelection: true, flavorType: 'whisky_jack', nextStep: 'ice' }
            ],
            'drinks-gin': [
                { id: 'danoninho-gin', name: 'Danoninho de Gin', description: 'Batida com Gin', price: 18.00, requiresFlavorSelection: true, flavorType: 'gin_sabores' },
                { id: 'copa-gin', name: 'Cop√£o de Gin', description: 'Drink com Gin Askov', price: 18.00, requiresFlavorSelection: true, flavorType: 'gin_sabores', nextStep: 'ice' }
            ],
            'drinks-vodka': [
                { id: 'danoninho-corote', name: 'Danoninho Corote', description: 'Batida com Corote', price: 16.00, requiresFlavorSelection: true, flavorType: 'corote_sabores' },
                { id: 'danoninho-askov', name: 'Danoninho Askov', description: 'Askov de frutas', price: 18.00, requiresFlavorSelection: true, flavorType: 'vodka_sabores' }
            ],
            'drinks-vinho': [
                { id: 'danoninho-vinho', name: 'Danoninho de Vinho', description: 'Batida de vinho', price: 18.00, requiresFlavorSelection: false }
            ],
            'cervejas': [
                { id: 'brahma', name: 'Brahma', description: 'Cerveja pilsen', price: 4.25 },
                { id: 'skol', name: 'Skol', description: 'Cerveja pilsen', price: 4.25 },
                { id: 'antarctica', name: 'Antarctica', description: 'Cerveja pilsen', price: 4.25 },
                { id: 'heineken', name: 'Heineken', description: 'Cerveja premium', price: 6.50 },
                { id: 'corona-long', name: 'Corona Long', description: 'Cerveja mexicana', price: 8.50 },
                { id: 'stella-long', name: 'Stella Long', description: 'Cerveja belga', price: 7.50 },
                { id: 'spaten', name: 'Spaten', description: 'Cerveja alem√£', price: 5.50 },
                { id: 'budweiser', name: 'Budweiser', description: 'Cerveja americana', price: 5.50 },
                { id: 'original', name: 'Original', description: 'Cerveja premium', price: 5.50 },
                { id: 'amstel', name: 'Amstel', description: 'Cerveja holandesa', price: 4.00 }
            ],
            'destilados': [
                { id: 'tequila', name: 'Tequila', description: 'Destilado mexicano', price: 23.00 },
                { id: 'pinga-51', name: 'Pinga 51', description: 'Cacha√ßa', price: 19.00 },
                { id: 'conhaque', name: 'Conhaque', description: 'Destilado', price: 19.00 },
                { id: 'gin-askov', name: 'Gin Askov', description: 'Gin brasileiro', price: 20.00, requiresFlavorSelection: true, flavorType: 'gin_sabores' },
                { id: 'askov-ice', name: 'Askov Ice', description: 'Ready to drink', price: 8.00, requiresFlavorSelection: true, flavorType: 'ice_askov' },
                { id: 'ice-leev', name: 'Ice Leev', description: 'Ready to drink', price: 8.00, requiresFlavorSelection: true, flavorType: 'ice_leev' },
                { id: 'beats-lata', name: 'Beats Lata', description: 'Bebida em lata', price: 7.50, requiresFlavorSelection: true, flavorType: 'beats' },
                { id: 'smirnoff-1l', name: 'Smirnoff 1L', description: 'Vodka premium', price: 56.00 }
            ],
            'aguas': [
                { id: 'agua-500ml', name: '√Ågua 500ml', description: '√Ågua mineral', price: 3.00 },
                { id: 'agua-1.5l', name: '√Ågua 1,5L', description: '√Ågua fam√≠lia', price: 6.00 },
                { id: 'agua-gas-500ml', name: '√Ågua G√°s 500ml', description: '√Ågua com g√°s', price: 3.50 },
                { id: 'h2o-500ml', name: 'H2O 500ml', description: '√Ågua premium', price: 5.00, requiresFlavorSelection: true, flavorType: 'h2o_sabores' },
                { id: 'gatorade', name: 'Gatorade', description: 'Isot√¥nico', price: 7.50 }
            ],
            'refri-latas': [
                { id: 'coca-cola-lata', name: 'Coca Cola', description: 'Refrigerante', price: 4.50 },
                { id: 'guarana-antarctica', name: 'Guaran√° Antarctica', description: 'Refrigerante', price: 4.50 },
                { id: 'fanta-laranja', name: 'Fanta Laranja', description: 'Refrigerante', price: 4.50 },
                { id: 'pepsi-black', name: 'Pepsi Black', description: 'Refrigerante', price: 4.50 },
                { id: 'coca-zero-lata', name: 'Coca Cola Zero', description: 'Refrigerante zero', price: 4.50 }
            ],
            'refri-pet': [
                { id: 'coca-2l', name: 'Coca-Cola 2L', description: 'Refrigerante', price: 13.00 },
                { id: 'coca-1l', name: 'Coca-Cola 1L', description: 'Refrigerante', price: 9.00 },
                { id: 'sprite-2l', name: 'Sprite 2L', description: 'Refrigerante', price: 11.00 },
                { id: 'guarana-2l', name: 'Ant√°rctica 2L', description: 'Guaran√°', price: 12.00 },
                { id: 'coca-600ml', name: 'Coca 600ml', description: 'Refrigerante', price: 7.50 }
            ],
            'sucos': [
                { id: 'del-valle-1l', name: 'Del Valle 1L', description: 'Suco de caixinha', price: 12.00, requiresFlavorSelection: true, flavorType: 'suco_delvalle' },
                { id: 'prats-300ml-laranja', name: 'Prats 300ml', description: 'Suco de laranja', price: 6.00 },
                { id: 'kapo', name: 'Kapo', description: 'Suco em p√≥', price: 4.00, requiresFlavorSelection: true, flavorType: 'suco_kapo' },
                { id: 'life-900ml', name: 'Life 900ml', description: 'Suco premium', price: 14.00, requiresFlavorSelection: true, flavorType: 'suco_life' }
            ],
            'energeticos': [
                { id: 'big-power-2l', name: 'Big Power 2L', description: 'Energ√©tico', price: 13.00 },
                { id: 'monster-473ml', name: 'Monster 473ml', description: 'Energ√©tico', price: 12.00, requiresFlavorSelection: true, flavorType: 'energetico_monster' },
                { id: 'red-bull-250ml', name: 'Red Bull', description: 'Energ√©tico', price: 14.00 },
                { id: 'bally-2l', name: 'Bally 2L', description: 'Energ√©tico', price: 15.00, requiresFlavorSelection: true, flavorType: 'energetico_bally' }
            ],
            'gelo-carvao': [
                { id: 'gelo-saborizado', name: 'Gelo Saborizado', description: 'Gelo com sabor', price: 3.00, requiresFlavorSelection: true, flavorType: 'gelo_sabores' },
                { id: 'carvao-3kg', name: 'Carv√£o 3kg', description: 'Carv√£o', price: 20.00 },
                { id: 'gelo-4.5kg', name: 'Gelo 4,5Kg', description: 'Gelo', price: 11.00 }
            ],
            'salgadinhos': [
                { id: 'salgadinho-bacon', name: 'Salgadinho de Bacon', description: 'Salgadinho', price: 4.50 },
                { id: 'amendoim-descascado', name: 'Amendoim Descascado', description: 'Salgado', price: 4.50 },
                { id: 'amendoim-com-casca', name: 'Amendoim com Casca', description: 'Salgado', price: 4.50 },
                { id: 'cheetos-160g', name: 'Cheetos 160g', description: 'Salgadinho grande', price: 17.00 },
                { id: 'cheetos-35g', name: 'Cheetos 35g', description: 'Salgadinho pequeno', price: 6.00 },
                { id: 'doritos-32g', name: 'Doritos 32g', description: 'Doritos pequeno', price: 7.00 },
                { id: 'doritos-120g', name: 'Doritos 120g', description: 'Doritos m√©dio', price: 17.00 },
                { id: 'fandangos-35g', name: 'Fandangus 35g', description: 'Salgadinho pequeno', price: 6.00 }
                { id: 'fandangos-160g', name: 'Fandangus 160g', description: 'Salgadinho grande', price: 17.00 }
            ],
            'doces': [
                { id: 'pacoca-caseira', name: 'Pa√ßoca Caseira', description: 'Doce de amendoim', price: 3.50 },
                { id: 'pacoca-rolha', name: 'Pa√ßoca de rolha', description: 'Doce de amendoim', price: 3.50 },
                { id: 'kit-kat', name: 'Kit Kat', description: 'Chocolate', price: 6.00 },
            ]
        };

        // ============================================
        // CAT√ÅLOGO DE SABORES
        // ============================================
        const FLAVOR_CATALOG = {
            'whisky_oldstar': ['Old Star Tradicional', 'Old Star Ma√ß√£-Verde'],
            'whisky_jack': ['Jack Tradicional', 'Jack Mel', 'Jack Ma√ß√£-Verde'],
            'whisky_sem_sabor': ['Tradicional'],
            'gin_sabores': ['Tropical', 'Melancia', 'Morango', 'Ma√ß√£-Verde'],
            'corote_sabores': ['Morango', 'Mel√¢ncia', 'Maracuj√°', 'P√™ssego', 'Blueberry', 'Lim√£o', 'Canelinha'],
            'vodka_sabores': ['Frutas Vermelhas', 'Maracuj√°', 'Frutas Roxas', 'Kiwi', 'P√™ssego', 'Lim√£o', 'Blueberry'],
            'ice_askov': ['Maracuj√°', 'Lim√£o', 'Frutas Vermelhas', 'Pina Colada'],
            'ice_leev': ['Morango', 'Lim√£o', 'Mel√¢ncia', 'Maracuj√°', 'Abacaxi com Hortel√£', 'Ma√ß√£-Verde'],
            'beats': ['Sense', 'GT', 'Red Mix', 'Green Mix'],
            'h2o_sabores': ['Lim√£o', 'Limoneto'],
            'suco_delvalle': ['Laranja', 'Manga', 'Maracuj√°', 'Caju', 'Uva', 'P√™ssego'],
            'suco_kapo': ['Uva', 'Morango', 'Maracuj√°', 'Laranja'],
            'suco_life': ['Uva', 'Laranja'],
            'energetico_monster': ['Tradicional', 'Zero', 'Uva', 'Mango Loco', 'Melancia', 'Cereja', 'P√™ssego'],
            'energetico_bally': ['Tradicional', 'Morango/P√™ssego', 'Melancia', 'Tropical'],
            'gelo_sabores': ['Melancia', 'Morango', 'Lim√£o', 'C√¥co', 'Ma√ß√£-Verde', 'Abacaxi/Hortel√£', 'Maracuj√°', 'Laranja']
        };

        const FLAVOR_TYPES = {
            'whisky_oldstar': 'Old Star',
            'whisky_jack': 'Jack Daniels',
            'whisky_sem_sabor': 'Whisky',
            'gin_sabores': 'Gin',
            'corote_sabores': 'Corote',
            'vodka_sabores': 'Vodka',
            'ice_askov': 'Askov Ice',
            'ice_leev': 'Ice Leev',
            'beats': 'Beats',
            'h2o_sabores': 'H2O',
            'suco_delvalle': 'Suco Del Valle',
            'suco_kapo': 'Kapo',
            'suco_life': 'Life',
            'energetico_monster': 'Monster',
            'energetico_bally': 'Bally',
            'gelo_sabores': 'Gelo'
        };

        // ============================================
        // ESTADO GLOBAL
        // ============================================
        const state = {
            cart: [],
            currentCategory: 'drinks-whisky',
            deliveryType: 'pickup',
            paymentMethod: null,
            paymentConfirmed: false,
            paymentProcessing: false,
            currentOrderId: null,
            pendingProduct: null,
            pendingFlavors: {},
            currentFlavorStep: null,
            currentButton: null,
            adminAuthenticated: false,
            adminToken: null,
            productAvailability: {},
            flavorAvailability: {},
            ageVerified: false,
            backendOnline: null,
            offlineSince: null,
            syncQueue: [],
            mpInstance: null
        };

        // ============================================
        // CARREGAR CONFIGURA√á√ÉO SEGURA DO BACKEND
        // ============================================
        async function loadSecureConfig() {
            try {
                const response = await fetch('/api/config', {
                    method: 'GET',
                    headers: { 'Cache-Control': 'no-cache' }
                });
                
                if (response.ok) {
                    const config = await response.json();
                    CONFIG = { ...CONFIG, ...config, adminPassword: null };
                    console.log('‚úÖ Configura√ß√£o carregada do backend');
                    if (CONFIG.mercadoPago?.publicKey) initMercadoPago();
                    return true;
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Backend offline, usando URL fixa do Azure');
                CONFIG.backendUrl = 'https://bebcom-delivery-api-1980-bchkauhjf0djajag.brazilsouth-01.azurewebsites.net';
                CONFIG.whatsappNumber = '5514996130369';
                CONFIG.mercadoPago = { publicKey: null, testMode: true };
                showNotification('‚úÖ Conectado ao servidor Azure', 'info');
                return false;
            }
        }

        // ============================================
        // INICIALIZAR MERCADO PAGO
        // ============================================
        function initMercadoPago() {
            try {
                if (window.MercadoPago && CONFIG.mercadoPago?.publicKey) {
                    state.mpInstance = new MercadoPago(CONFIG.mercadoPago.publicKey, { locale: 'pt-BR' });
                    console.log('‚úÖ Mercado Pago SDK inicializado');
                }
            } catch (error) {
                console.error('‚ùå Erro ao inicializar Mercado Pago:', error);
            }
        }

        // ============================================
        // VERIFICA√á√ÉO DE IDADE
        // ============================================
        function initAgeVerification() {
            state.ageVerified = true;
            
            const hasConfirmed = localStorage.getItem('bebcom_age_verified');
            const verifiedTime = localStorage.getItem('bebcom_age_verified_time');
            
            if (hasConfirmed === 'true' && verifiedTime) {
                const hoursSinceVerification = (Date.now() - parseInt(verifiedTime)) / (1000 * 60 * 60);
                if (hoursSinceVerification < 24) {
                    document.getElementById('ageVerificationModal').style.display = 'none';
                    document.body.style.overflow = 'auto';
                    initAfterAgeVerification();
                    return;
                }
            }
            
            const modal = document.getElementById('ageVerificationModal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            const checkbox = document.getElementById('ageConfirmationCheckbox');
            const enterBtn = document.getElementById('enterSiteButton');
            
            checkbox.addEventListener('change', function() { enterBtn.disabled = !this.checked; });
            
            enterBtn.addEventListener('click', async function() {
                if (!checkbox.checked) return;
                localStorage.setItem('bebcom_age_verified', 'true');
                localStorage.setItem('bebcom_age_verified_time', Date.now().toString());
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                initAfterAgeVerification();
            });
            
            setTimeout(() => {
                if (document.getElementById('ageVerificationModal').style.display !== 'flex') {
                    initAfterAgeVerification();
                }
            }, 100);
        }

        // ============================================
        // INICIALIZA√á√ÉO P√ìS-VERIFICA√á√ÉO DE IDADE
        // ============================================
        async function initAfterAgeVerification() {
            console.log('‚úÖ Inicializando interface...');
            await loadAvailability();
            loadCart();
            showCategory('drinks-whisky');
            setupEventListeners();
            setupPhoneMask();
            selectDeliveryType('pickup');
            setInterval(checkBackendHealth, 300000);
        }

        // ============================================
        // STORAGE MANAGEMENT
        // ============================================
        function initStorage() {
            if (!localStorage.getItem('bebcom_product_availability')) {
                const defaultAvailability = {};
                Object.keys(products).forEach(cat => {
                    products[cat].forEach(p => { defaultAvailability[p.id] = true; });
                });
                localStorage.setItem('bebcom_product_availability', JSON.stringify(defaultAvailability));
                state.productAvailability = defaultAvailability;
            } else {
                state.productAvailability = JSON.parse(localStorage.getItem('bebcom_product_availability'));
            }
            
            if (!localStorage.getItem('bebcom_flavor_availability')) {
                const defaultFlavors = {};
                Object.keys(FLAVOR_CATALOG).forEach(type => {
                    FLAVOR_CATALOG[type].forEach(flavor => {
                        defaultFlavors[`${type}_${flavor}`] = true;
                    });
                });
                localStorage.setItem('bebcom_flavor_availability', JSON.stringify(defaultFlavors));
                state.flavorAvailability = defaultFlavors;
            } else {
                state.flavorAvailability = JSON.parse(localStorage.getItem('bebcom_flavor_availability'));
            }
        }

        // ============================================
        // BACKEND HEALTH CHECK
        // ============================================
        async function checkBackendHealth() {
            if (!CONFIG.backendUrl) return false;
            try {
                const response = await fetch(`${CONFIG.backendUrl}/health`, {
                    method: 'GET',
                    headers: { 'Cache-Control': 'no-cache' }
                });
                if (response.ok) {
                    state.backendOnline = true;
                    state.offlineSince = null;
                    console.log('‚úÖ Backend online');
                    syncPendingData();
                    return true;
                }
            } catch (error) {
                state.backendOnline = false;
                state.offlineSince = state.offlineSince || Date.now();
                console.warn('‚ö†Ô∏è Backend offline - Modo local');
                return false;
            }
        }

        // ============================================
        // CARREGAR DISPONIBILIDADE - ‚úÖ CORRIGIDO: SEMPRE BUSCA DO SERVIDOR!
        // ============================================
        async function loadAvailability() {
            try {
                // SEMPRE tenta buscar do servidor primeiro
                if (CONFIG.backendUrl) {
                    // Verifica se o backend est√° online
                    await checkBackendHealth();
                    
                    if (state.backendOnline) {
                        console.log('üì° Buscando disponibilidade do servidor...');
                        
                        const [productsRes, flavorsRes] = await Promise.all([
                            fetch(`${CONFIG.backendUrl}/api/product-availability`),
                            fetch(`${CONFIG.backendUrl}/api/flavor-availability`)
                        ]);
                        
                        if (productsRes.ok) {
                            const productData = await productsRes.json();
                            if (productData.success && productData.productAvailability) {
                                // ‚úÖ ATUALIZA o estado com os dados do servidor
                                state.productAvailability = productData.productAvailability;
                                // ‚úÖ ATUALIZA o cache local
                                localStorage.setItem('bebcom_product_availability', JSON.stringify(state.productAvailability));
                                console.log('‚úÖ Produtos carregados do servidor');
                            }
                        }
                        
                        if (flavorsRes.ok) {
                            const flavorData = await flavorsRes.json();
                            if (flavorData.success && flavorData.flavorAvailability) {
                                // ‚úÖ ATUALIZA o estado com os dados do servidor
                                state.flavorAvailability = flavorData.flavorAvailability;
                                // ‚úÖ ATUALIZA o cache local
                                localStorage.setItem('bebcom_flavor_availability', JSON.stringify(state.flavorAvailability));
                                console.log('‚úÖ Sabores carregados do servidor');
                            }
                        }
                        
                        // ‚úÖ ATUALIZA a interface imediatamente
                        updateMenuAvailability();
                        
                        // ‚úÖ Se o admin estiver logado, recarrega o painel
                        if (document.getElementById('adminMain').style.display === 'block') {
                            loadAdminProducts();
                        }
                        
                        return;
                    }
                }
                
                // ‚ö†Ô∏è Fallback: s√≥ usa cache local se servidor estiver offline
                console.log('‚ö†Ô∏è Servidor offline, usando dados locais');
                initStorage();
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar disponibilidade:', error);
                // Fallback para cache local
                initStorage();
            }
        }

        // ============================================
        // FUN√á√ïES DE PRODUTO
        // ============================================
        function isProductAvailable(productId) {
            return state.productAvailability[productId] !== false;
        }

        function isFlavorAvailable(flavorType, flavorName) {
            const key = `${flavorType}_${flavorName}`;
            return state.flavorAvailability[key] !== false;
        }

        function findProductById(productId) {
            for (const cat in products) {
                const found = products[cat].find(p => p.id === productId);
                if (found) return found;
            }
            return null;
        }

        // ============================================
        // EXIBIR CATEGORIA
        // ============================================
        function showCategory(categoryId) {
            state.currentCategory = categoryId;
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = '';
            
            const categoryProducts = products[categoryId] || [];
            if (categoryProducts.length === 0) {
                grid.innerHTML = '<div style="text-align: center; color: #aaa; padding: 50px;">Nenhum produto nesta categoria</div>';
                return;
            }
            
            categoryProducts.forEach(product => {
                const available = isProductAvailable(product.id);
                const hasFlavors = product.requiresFlavorSelection || false;
                const card = document.createElement('div');
                card.className = `product-card ${!available ? 'unavailable' : ''} ${hasFlavors ? 'with-flavors' : ''}`;
                card.setAttribute('data-product-id', product.id);
                
                let btnText = 'üõí Adicionar';
                let btnClass = 'add-to-cart-btn';
                if (!available) {
                    btnText = '‚ùå Indispon√≠vel';
                } else if (hasFlavors) {
                    btnText = '‚ö° Escolher Sabores';
                    btnClass += ' has-flavors';
                }
                
                card.innerHTML = `
                    ${hasFlavors ? '<div class="flavor-badge">‚ö°</div>' : ''}
                    <div class="product-name">${product.name}</div>
                    <div class="product-info">${product.description}</div>
                    <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                    <button class="${btnClass}" onclick="handleAddToCart('${product.id}', this)" ${!available ? 'disabled' : ''}>
                        ${btnText}
                    </button>
                `;
                grid.appendChild(card);
            });
        }

        // ============================================
        // ADICIONAR AO CARRINHO - ‚úÖ CORRIGIDO!
        // ============================================
        function handleAddToCart(productId, button) {
            const product = findProductById(productId);
            if (!product) return;
            if (!isProductAvailable(productId)) {
                showNotification('‚ùå Produto indispon√≠vel', 'error');
                return;
            }
            if (product.requiresFlavorSelection) {
                state.pendingProduct = product;
                state.pendingFlavors = {};
                state.currentFlavorStep = 'primary';
                state.currentButton = button;

                // ‚úÖ Garante que sempre h√° um flavorType
                const flavorType = product.flavorType || 'whisky_sem_sabor';
                const flavors = FLAVOR_CATALOG[flavorType] || [];
                const hasAvailable = flavors.some(f => isFlavorAvailable(flavorType, f));

                if (!hasAvailable) {
                    showNotification('‚ùå Todos os sabores est√£o indispon√≠veis', 'error');
                    return;
                }

                // ‚úÖ Define o flavorType no produto (se n√£o existir)
                if (!product.flavorType) {
                    product.flavorType = 'whisky_sem_sabor';
                }

                openFlavorModal(product, 'primary');
            } else {
                addToCartDirect(product, button);
            }
        }

        // ============================================
        // MODAL DE SABORES
        // ============================================
        function openFlavorModal(product, step) {
            const modal = document.getElementById('flavorModal');
            const title = document.getElementById('flavorModalTitle');
            const instruction = document.getElementById('flavorModalInstruction');
            const grid = document.getElementById('flavorsGrid');
            const confirmBtn = document.getElementById('confirmFlavorButton');
            
            grid.innerHTML = '<div style="text-align: center; padding: 30px;">Carregando...</div>';
            
            setTimeout(() => {
                grid.innerHTML = '';
                let flavorType = product.flavorType;
                let flavors = FLAVOR_CATALOG[flavorType] || [];
                
                if (step === 'ice') {
                    flavorType = 'gelo_sabores';
                    flavors = FLAVOR_CATALOG.gelo_sabores || [];
                    title.textContent = 'üßä Escolha o sabor do gelo';
                    instruction.textContent = 'Selecione o sabor do gelo (sem custo)';
                } else {
                    title.textContent = `Escolha o sabor do ${FLAVOR_TYPES[flavorType] || 'produto'}`;
                    instruction.textContent = `Selecione o sabor para ${product.name}`;
                }
                
                if (flavors.length === 0) {
                    grid.innerHTML = '<div style="text-align: center; padding: 30px; color: #dc2626;">Nenhum sabor dispon√≠vel</div>';
                    confirmBtn.disabled = true;
                    return;
                }
                
                let hasAvailable = false;
                flavors.forEach(flavor => {
                    const available = isFlavorAvailable(flavorType, flavor);
                    if (available) hasAvailable = true;
                    const option = document.createElement('div');
                    option.className = `flavor-option ${!available ? 'unavailable' : ''}`;
                    option.textContent = flavor;
                    option.dataset.flavor = flavor;
                    if (available) {
                        option.onclick = function() {
                            document.querySelectorAll('.flavor-option').forEach(el => el.classList.remove('selected'));
                            this.classList.add('selected');
                            if (step === 'primary') state.pendingFlavors.primary = flavor;
                            else if (step === 'ice') state.pendingFlavors.ice = flavor;
                            confirmBtn.disabled = false;
                        };
                    }
                    grid.appendChild(option);
                });
                
                if (!hasAvailable) {
                    instruction.textContent = '‚ö†Ô∏è Todos os sabores est√£o indispon√≠veis';
                    instruction.style.color = '#dc2626';
                }
                confirmBtn.disabled = true;
                modal.style.display = 'flex';
            }, 100);
        }

        // ‚úÖ FUN√á√ÉO CORRIGIDA - AGORA FUNCIONA COM 2 MODAIS!
        function confirmFlavorSelection() {
            if (state.currentFlavorStep === 'primary' && !state.pendingFlavors.primary) {
                showNotification('‚ùå Selecione um sabor', 'error');
                return;
            }
            if (state.currentFlavorStep === 'ice' && !state.pendingFlavors.ice) {
                showNotification('‚ùå Selecione um sabor de gelo', 'error');
                return;
            }
            
            document.getElementById('flavorModal').style.display = 'none';
            
            // ‚úÖ Se √© o primeiro modal (sabor) e o produto tem gelo, abre o modal de gelo
            if (state.currentFlavorStep === 'primary' && state.pendingProduct.nextStep === 'ice') {
                state.currentFlavorStep = 'ice'; // ‚úÖ Garante que o pr√≥ximo passo √© gelo
                openFlavorModal(state.pendingProduct, 'ice');
            } 
            // ‚úÖ Se √© o modal de gelo OU o produto n√£o tem pr√≥ximo passo, adiciona ao carrinho
            else {
                addToCartWithFlavors();
            }
        }

        function cancelFlavorSelection() {
            document.getElementById('flavorModal').style.display = 'none';
            state.pendingProduct = null;
            state.pendingFlavors = {};
            state.currentFlavorStep = null;
            state.currentButton = null;
        }

        function addToCartWithFlavors() {
            if (!state.pendingProduct) return;
            const product = state.pendingProduct;
            const flavors = state.pendingFlavors;
            const existing = state.cart.find(item => 
                item.name === product.name && 
                JSON.stringify(item.flavors) === JSON.stringify(flavors)
            );
            
            if (existing) {
                existing.quantity += 1;
            } else {
                state.cart.push({ 
                    name: product.name, 
                    price: product.price, 
                    quantity: 1, 
                    productId: product.id, 
                    flavors: { ...flavors } 
                });
            }
            updateCart(); 
            saveCart();
            
            if (state.currentButton) {
                const original = state.currentButton.innerHTML;
                state.currentButton.innerHTML = '‚úì Adicionado!';
                state.currentButton.classList.add('added');
                setTimeout(() => { 
                    state.currentButton.innerHTML = original; 
                    state.currentButton.classList.remove('added'); 
                }, 1000);
            }
            
            state.pendingProduct = null; 
            state.pendingFlavors = {}; 
            state.currentFlavorStep = null; 
            state.currentButton = null;
            
            showNotification(`‚úÖ ${product.name} adicionado`);
        }

        function addToCartDirect(product, button) {
            const existing = state.cart.find(item => item.name === product.name && !item.flavors);
            if (existing) existing.quantity += 1;
            else state.cart.push({ name: product.name, price: product.price, quantity: 1, productId: product.id });
            updateCart(); saveCart();
            if (button) {
                const original = button.innerHTML;
                button.innerHTML = '‚úì Adicionado!';
                button.classList.add('added');
                setTimeout(() => { button.innerHTML = original; button.classList.remove('added'); }, 1000);
            }
            showNotification(`‚úÖ ${product.name} adicionado`);
        }

        // ============================================
        // FUN√á√ïES DO CARRINHO
        // ============================================
        function updateCart() {
            const cartEl = document.getElementById('cartItems');
            const subtotalEl = document.getElementById('subtotal');
            const totalEl = document.getElementById('totalAmount');
            const deliveryRow = document.getElementById('deliveryRow');
            const deliveryFeeEl = document.getElementById('deliveryFee');
            
            let subtotal = 0;
            if (state.cart.length === 0) {
                cartEl.innerHTML = '<div style="text-align: center; color: #aaa; padding: 40px;">Seu carrinho est√° vazio</div>';
                subtotalEl.textContent = '0.00'; totalEl.textContent = '0.00'; validateForm(); return;
            }
            
            cartEl.innerHTML = '';
            state.cart.forEach((item, idx) => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                let itemName = item.name;
                if (item.flavors) {
                    if (item.flavors.primary) itemName += ` (${item.flavors.primary})`;
                    if (item.flavors.ice) itemName += ` - Gelo: ${item.flavors.ice}`;
                }
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div><strong>${itemName}</strong><br><small>R$ ${item.price.toFixed(2)}</small></div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button onclick="updateQuantity(${idx}, -1)" class="quantity-btn">-</button>
                        <span style="min-width: 30px; text-align: center; font-weight: bold;">${item.quantity}</span>
                        <button onclick="updateQuantity(${idx}, 1)" class="quantity-btn">+</button>
                        <span style="margin-left: 10px; font-weight: bold; color: #4d96ff;">R$ ${itemTotal.toFixed(2)}</span>
                        <button onclick="removeFromCart(${idx})" class="remove-item-btn" style="background: none; border: none; color: #dc3545; font-size: 20px; cursor: pointer;">√ó</button>
                    </div>
                `;
                cartEl.appendChild(cartItem);
            });
            
            let deliveryFee = 0;
            if (state.deliveryType === 'delivery') {
                deliveryFee = CONFIG.deliveryRates.baseFee;
                if (subtotal >= CONFIG.deliveryRates.freeDeliveryMin) deliveryFee = 0;
                deliveryRow.style.display = 'flex';
                deliveryFeeEl.textContent = deliveryFee.toFixed(2);
            } else deliveryRow.style.display = 'none';
            
            const total = subtotal + deliveryFee;
            subtotalEl.textContent = subtotal.toFixed(2);
            totalEl.textContent = total.toFixed(2);
            validateForm();
        }

        function updateQuantity(index, change) {
            if (state.cart[index]) {
                const newQty = state.cart[index].quantity + change;
                if (newQty < 1) removeFromCart(index);
                else if (newQty > 50) showNotification('‚ùå M√°ximo 50 unidades', 'error');
                else { state.cart[index].quantity = newQty; updateCart(); saveCart(); }
            }
        }

        function removeFromCart(index) {
            if (state.cart[index]) {
                const name = state.cart[index].name;
                state.cart.splice(index, 1);
                updateCart(); saveCart();
                showNotification(`üóëÔ∏è ${name} removido`);
            }
        }

        function clearCart() {
            if (state.cart.length === 0) return;
            if (confirm('Limpar carrinho?')) {
                state.cart = [];
                updateCart(); saveCart();
                showNotification('üóëÔ∏è Carrinho limpo');
            }
        }

        function saveCart() {
            localStorage.setItem('bebcom_cart', JSON.stringify({ items: state.cart, timestamp: Date.now() }));
        }

        function loadCart() {
            const saved = localStorage.getItem('bebcom_cart');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (Date.now() - (data.timestamp || 0) < 24 * 60 * 60 * 1000) state.cart = data.items || [];
                    else { localStorage.removeItem('bebcom_cart'); state.cart = []; }
                    updateCart();
                } catch (e) { state.cart = []; }
            }
        }

        // ============================================
        // ENTREGA E PAGAMENTO
        // ============================================
        function selectDeliveryType(type) {
            state.deliveryType = type;
            const pickupBtn = document.querySelectorAll('.delivery-option')[0];
            const deliveryBtn = document.querySelectorAll('.delivery-option')[1];
            const addressFields = document.getElementById('addressFields');
            const paymentLabel = document.getElementById('paymentLabel');
            const paymentMethods = document.getElementById('paymentMethods');
            const payButton = document.getElementById('payButton');
            
            if (type === 'pickup') {
                pickupBtn.classList.add('selected'); deliveryBtn.classList.remove('selected');
                addressFields.style.display = 'none'; paymentLabel.style.display = 'none';
                paymentMethods.style.display = 'none'; payButton.disabled = true;
                payButton.innerHTML = 'üè™ Retirada no Local';
                state.paymentMethod = null; state.paymentConfirmed = false;
            } else {
                pickupBtn.classList.remove('selected'); deliveryBtn.classList.add('selected');
                addressFields.style.display = 'block'; paymentLabel.style.display = 'block';
                paymentMethods.style.display = 'grid'; payButton.disabled = false;
                selectPaymentMethod('pix');
            }
            updateCart(); validateForm();
        }

        function selectPaymentMethod(method) {
            if (state.deliveryType !== 'delivery') return;
            state.paymentMethod = method;
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('selected'));
            const selected = document.querySelector(`.payment-method:nth-child(${method === 'pix' ? 1 : 2})`);
            if (selected) selected.classList.add('selected');
            const payBtn = document.getElementById('payButton');
            payBtn.innerHTML = method === 'pix' ? 'üßæ Pagar com PIX' : 'üí≥ Pagar com Cart√£o';
        }

        function validateForm() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const whatsappBtn = document.getElementById('whatsappButton');
            let isValid = true;
            if (name.length < 3) isValid = false;
            const phoneClean = phone.replace(/\D/g, '');
            if (phoneClean.length < 10 || phoneClean.length > 11) isValid = false;
            if (state.cart.length === 0) isValid = false;
            if (state.deliveryType === 'delivery') {
                const street = document.getElementById('street').value.trim();
                const number = document.getElementById('number').value.trim();
                const neighborhood = document.getElementById('neighborhood').value.trim();
                if (!street || street.length < 3) isValid = false;
                if (!number) isValid = false;
                if (!neighborhood || neighborhood.length < 3) isValid = false;
                if (!state.paymentMethod) isValid = false;
                if (!state.paymentConfirmed) isValid = false;
            }
            whatsappBtn.disabled = !isValid;
            return isValid;
        }

        function validateOrder() {
            const errors = [];
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            if (!name) errors.push('‚Ä¢ Nome obrigat√≥rio');
            if (!phone || phone.replace(/\D/g, '').length < 10) errors.push('‚Ä¢ WhatsApp inv√°lido');
            if (state.cart.length === 0) errors.push('‚Ä¢ Carrinho vazio');
            if (state.deliveryType === 'delivery') {
                if (!document.getElementById('street').value.trim()) errors.push('‚Ä¢ Rua obrigat√≥ria');
                if (!document.getElementById('number').value.trim()) errors.push('‚Ä¢ N√∫mero obrigat√≥rio');
                if (!document.getElementById('neighborhood').value.trim()) errors.push('‚Ä¢ Bairro obrigat√≥rio');
                if (!state.paymentMethod) errors.push('‚Ä¢ Selecione pagamento');
                if (!state.paymentConfirmed) errors.push('‚Ä¢ Confirme o pagamento');
            }
            return errors;
        }

        function prepareOrderData() {
            const items = state.cart.map(item => ({ name: item.name, quantity: item.quantity, price: item.price, flavors: item.flavors || null }));
            const subtotal = items.reduce((sum, i) => sum + (i.quantity * i.price), 0);
            let deliveryFee = 0;
            if (state.deliveryType === 'delivery') {
                deliveryFee = CONFIG.deliveryRates.baseFee;
                if (subtotal >= CONFIG.deliveryRates.freeDeliveryMin) deliveryFee = 0;
            }
            return { items, subtotal, deliveryFee, total: subtotal + deliveryFee };
        }

        // ============================================
        // PROCESSAMENTO DE PAGAMENTO
        // ============================================
        async function processPayment() {
            if (state.deliveryType === 'pickup') {
                showNotification('‚úÖ Pagamento ser√° realizado na retirada', 'info');
                return;
            }
            if (state.paymentProcessing) return;
            const errors = validateOrder();
            if (errors.length > 0) { showNotification(errors.join('\n'), 'error'); return; }
            
            state.paymentProcessing = true;
            const button = document.getElementById('payButton');
            const original = button.innerHTML;
            const statusDiv = document.getElementById('paymentStatus');
            button.innerHTML = '<span class="loading-spinner"></span> Processando...';
            button.disabled = true;
            statusDiv.style.display = 'block';
            statusDiv.className = 'payment-status';
            statusDiv.innerHTML = 'üîÑ Processando pagamento...';
            
            try {
                const orderData = prepareOrderData();
                state.currentOrderId = 'BEB' + Date.now().toString().slice(-8);
                if (state.backendOnline && CONFIG.backendUrl) {
                    const response = await fetch(`${CONFIG.backendUrl}/api/create-payment`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            orderId: state.currentOrderId,
                            customer: { name: document.getElementById('customerName').value.trim(), phone: document.getElementById('customerPhone').value.trim() },
                            items: orderData.items, total: orderData.total,
                            deliveryType: state.deliveryType, paymentMethod: state.paymentMethod
                        })
                    });
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            if (data.qrCode) showPixPayment(data.qrCode, data.copyPasteKey);
                            else if (data.paymentUrl) { window.open(data.paymentUrl, '_blank'); setTimeout(() => confirmPayment(), 3000); }
                            else confirmPayment();
                            return;
                        }
                    }
                }
                showManualPixPayment();
            } catch (error) {
                console.error('Erro no pagamento:', error);
                showManualPixPayment();
            } finally {
                button.innerHTML = original;
                button.disabled = false;
                state.paymentProcessing = false;
            }
        }

        function showPixPayment(qrCode, copyKey) {
            const statusDiv = document.getElementById('paymentStatus');
            const total = prepareOrderData().total;
            const escapedCopyKey = copyKey.replace(/'/g, "\\'").replace(/"/g, '&quot;');
            statusDiv.className = 'payment-status';
            statusDiv.innerHTML = `
                <div style="text-align: center;">
                    <h4 style="margin-bottom: 15px; color: #ffd93d;">üßæ PIX</h4>
                    <p>Valor: <strong style="font-size: 22px;">R$ ${total.toFixed(2)}</strong></p>
                    <div style="margin: 20px 0;"><img src="${qrCode}" alt="QR Code" style="width: 200px; height: 200px; border-radius: 12px; border: 2px solid #28a745;"></div>
                    <div style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <small style="color: #aaa;">Chave PIX:</small><br>
                        <span style="font-family: monospace; word-break: break-all; color: white;">${escapedCopyKey}</span>
                        <button onclick="navigator.clipboard.writeText('${escapedCopyKey}'); showNotification('Chave copiada!')" style="margin-top: 10px; background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üìã Copiar</button>
                    </div>
                    <button onclick="confirmPayment()" style="background: #28a745; color: white; border: none; padding: 14px 28px; border-radius: 10px; margin: 10px; font-weight: bold; cursor: pointer;">‚úÖ J√° Paguei</button>
                    <button onclick="cancelPayment()" style="background: #dc3545; color: white; border: none; padding: 14px 28px; border-radius: 10px; margin: 10px; font-weight: bold; cursor: pointer;">‚ùå Cancelar</button>
                </div>
            `;
            document.getElementById('payButton').style.display = 'none';
        }

        function showManualPixPayment() {
            const statusDiv = document.getElementById('paymentStatus');
            const total = prepareOrderData().total;
            statusDiv.className = 'payment-status';
            statusDiv.innerHTML = `
                <div style="text-align: center;">
                    <h4 style="margin-bottom: 15px; color: #ffd93d;">üßæ PIX Manual</h4>
                    <p>Valor: <strong style="font-size: 22px;">R$ ${total.toFixed(2)}</strong></p>
                    <div style="background: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <strong>Chave PIX (CNPJ):</strong><br>
                        <span style="font-family: monospace; font-size: 18px; color: #4d96ff;">12.345.678/0001-90</span>
                    </div>
                    <p style="color: #aaa;">Ap√≥s pagar, envie o comprovante pelo WhatsApp</p>
                    <button onclick="confirmPayment()" style="background: #28a745; color: white; border: none; padding: 14px 28px; border-radius: 10px; margin: 10px; font-weight: bold; cursor: pointer;">‚úÖ J√° Paguei</button>
                    <button onclick="cancelPayment()" style="background: #dc3545; color: white; border: none; padding: 14px 28px; border-radius: 10px; margin: 10px; font-weight: bold; cursor: pointer;">‚ùå Cancelar</button>
                </div>
            `;
            document.getElementById('payButton').style.display = 'none';
        }

        function cancelPayment() {
            state.paymentConfirmed = false;
            document.getElementById('paymentStatus').style.display = 'none';
            document.getElementById('payButton').style.display = 'block';
        }

        function confirmPayment() {
            state.paymentConfirmed = true;
            const statusDiv = document.getElementById('paymentStatus');
            statusDiv.className = 'payment-status success';
            statusDiv.innerHTML = '‚úÖ Pagamento confirmado!';
            document.getElementById('payButton').innerHTML = '‚úÖ Pagamento Confirmado';
            document.getElementById('payButton').disabled = true;
            document.getElementById('whatsappButton').disabled = false;
            showNotification('‚úÖ Pagamento confirmado! Envie o pedido.');
        }

        // ============================================
        // WHATSAPP
        // ============================================
        function sendToWhatsApp() {
            if (!validateForm()) { showNotification('Complete todas as informa√ß√µes', 'error'); return; }
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const street = document.getElementById('street').value.trim();
            const number = document.getElementById('number').value.trim();
            const neighborhood = document.getElementById('neighborhood').value.trim();
            const complement = document.getElementById('addressComplement').value.trim();
            const order = prepareOrderData();
            const orderId = state.currentOrderId || 'BEB' + Date.now().toString().slice(-8);
            
            let msg = `*üçπ PEDIDO BEBCOM DELIVERY*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìã *Pedido:* ${orderId}\nüë§ *Cliente:* ${name}\nüì± *WhatsApp:* ${phone}\nüì¶ *Tipo:* ${state.deliveryType === 'delivery' ? 'ENTREGA' : 'RETIRADA'}\n`;
            if (state.deliveryType === 'delivery') {
                msg += `üìç *Endere√ßo:* ${street}, ${number} - ${neighborhood}, Bauru\n`;
                if (complement) msg += `üè† *Complemento:* ${complement}\n`;
                msg += `üí≥ *Pagamento:* ${state.paymentMethod === 'pix' ? 'PIX' : 'Cart√£o'} ${state.paymentConfirmed ? '‚úÖ PAGO' : ''}\n`;
            }
            msg += `üïí *Data:* ${new Date().toLocaleString('pt-BR')}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n*üõí ITENS:*\n`;
            order.items.forEach((item, i) => {
                const total = item.price * item.quantity;
                msg += `\n${i+1}. ${item.name}\n`;
                if (item.flavors) {
                    if (item.flavors.primary) msg += `   üçπ Sabor: ${item.flavors.primary}\n`;
                    if (item.flavors.ice) msg += `   üßä Gelo: ${item.flavors.ice}\n`;
                }
                msg += `   ${item.quantity}x R$ ${item.price.toFixed(2)} = R$ ${total.toFixed(2)}\n`;
            });
            msg += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí∞ *Subtotal:* R$ ${order.subtotal.toFixed(2)}\n`;
            if (state.deliveryType === 'delivery') msg += `üöö *Entrega:* R$ ${order.deliveryFee.toFixed(2)}\n`;
            msg += `üíµ *TOTAL:* R$ ${order.total.toFixed(2)}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚úÖ *Pedido confirmado!*\nüéâ Obrigado pela prefer√™ncia!`;
            
            window.open(`https://wa.me/${CONFIG.whatsappNumber}?text=${encodeURIComponent(msg)}`, '_blank');
            showNotification('‚úÖ Pedido enviado!');
            state.paymentConfirmed = false;
            document.getElementById('paymentStatus').style.display = 'none';
            document.getElementById('payButton').style.display = 'block';
        }

        // ============================================
        // ADMINISTRA√á√ÉO SEGURA - ‚úÖ CORRIGIDO!
        // ============================================
        function initAdminSystem() {
            const adminBtn = document.getElementById('adminButton');
            const adminClose = document.getElementById('adminClose');
            const adminModal = document.getElementById('adminModal');
            
            adminBtn.addEventListener('click', openAdminPanel);
            adminClose.addEventListener('click', closeAdminPanel);
            adminModal.addEventListener('click', function(e) { if (e.target === this) closeAdminPanel(); });
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.altKey && e.key === 'a') { e.preventDefault(); openAdminPanel(); }
                if (e.key === 'Escape') closeAdminPanel();
            });
        }

        function openAdminPanel() {
            document.getElementById('adminModal').style.display = 'block';
            if (isAdminAuthenticated()) {
                state.adminAuthenticated = true;
                document.getElementById('passwordSection').style.display = 'none';
                document.getElementById('adminMain').style.display = 'block';
                document.getElementById('adminActions').style.display = 'flex';
                loadAdminProducts();
            } else {
                document.getElementById('passwordSection').style.display = 'block';
                document.getElementById('adminMain').style.display = 'none';
                document.getElementById('adminActions').style.display = 'none';
                document.getElementById('adminPassword').focus();
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminModal').style.display = 'none';
        }

        function isAdminAuthenticated() {
            const token = sessionStorage.getItem('admin_token');
            const expires = sessionStorage.getItem('admin_expires');
            if (!token || !expires) return false;
            if (Date.now() > parseInt(expires)) {
                sessionStorage.removeItem('admin_token');
                sessionStorage.removeItem('admin_expires');
                state.adminAuthenticated = false;
                return false;
            }
            state.adminToken = token;
            state.adminAuthenticated = true;
            return true;
        }

        async function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            const btn = document.querySelector('.password-button');
            const original = btn.innerHTML;
            
            if (!password) { showNotification('‚ùå Digite a senha', 'error'); return; }
            
            btn.innerHTML = '<span class="loading-spinner"></span> Verificando...';
            btn.disabled = true;
            
            try {
                const url = `${CONFIG.backendUrl}/api/admin/verify`;
                console.log('üì° Enviando requisi√ß√£o para:', url);
                
                const response = await fetch(url, {
                    method: 'POST', mode: 'cors', credentials: 'include',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify({ password })
                });
                
                console.log('üì• Status da resposta:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        sessionStorage.setItem('admin_token', data.token);
                        sessionStorage.setItem('admin_expires', (Date.now() + 30 * 60 * 1000).toString());
                        state.adminAuthenticated = true;
                        state.adminToken = data.token;
                        document.getElementById('passwordSection').style.display = 'none';
                        document.getElementById('adminMain').style.display = 'block';
                        document.getElementById('adminActions').style.display = 'flex';
                        loadAdminProducts();
                        showNotification('‚úÖ Acesso concedido');
                    } else throw new Error(data.error || 'Senha incorreta');
                } else if (response.status === 401) throw new Error('Senha incorreta');
                else if (response.status === 429) throw new Error('Muitas tentativas. Aguarde 15 minutos.');
                else throw new Error(`Erro ${response.status}: ${response.statusText}`);
            } catch (error) {
                console.error('‚ùå Erro detalhado:', error);
                showNotification('‚ùå ' + error.message, 'error');
                document.getElementById('adminPassword').value = '';
            } finally {
                btn.innerHTML = original;
                btn.disabled = false;
            }
        }

        function getAdminHeaders() {
            const headers = { 'Content-Type': 'application/json' };
            if (state.adminToken) headers['Authorization'] = `Bearer ${state.adminToken}`;
            return headers;
        }

        function loadAdminProducts() {
            const container = document.getElementById('adminMain');
            container.innerHTML = '';
            
            const categories = [
                { id: 'drinks-whisky', name: 'ü•É Drinks Whisky' },
                { id: 'drinks-gin', name: 'üç∏ Drinks Gin' },
                { id: 'drinks-vodka', name: 'üç∏ Drinks Vodka' },
                { id: 'drinks-vinho', name: 'üç∑ Drinks Vinho' },
                { id: 'cervejas', name: 'üç∫ Cervejas' },
                { id: 'destilados', name: 'ü•É Destilados' },
                { id: 'aguas', name: 'üíß √Åguas' },
                { id: 'refri-latas', name: 'ü•§ Refri Latas' },
                { id: 'refri-pet', name: 'ü•§ Refri PET' },
                { id: 'sucos', name: 'üßÉ Sucos' },
                { id: 'energeticos', name: '‚ö° Energ√©ticos' },
                { id: 'gelo-carvao', name: 'üßä Gelo/Carv√£o' },
                { id: 'salgadinhos', name: 'ü•® Salgadinhos' },
                { id: 'doces', name: 'üç¨ Doces' }
            ];
            
            categories.forEach(cat => {
                const section = document.createElement('div');
                section.className = 'admin-category-section';
                section.style.marginBottom = '30px';
                section.style.background = 'rgba(0,0,0,0.2)';
                section.style.padding = '20px';
                section.style.borderRadius = '12px';
                section.innerHTML = `<h3 style="color: #60a5fa; margin-bottom: 15px; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">${cat.name}</h3>`;
                
                const grid = document.createElement('div');
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(280px, 1fr))';
                grid.style.gap = '12px';
                
                const catProducts = products[cat.id] || [];
                catProducts.forEach(product => {
                    const available = isProductAvailable(product.id);
                    
                    const item = document.createElement('div');
                    item.style.display = 'flex';
                    item.style.justifyContent = 'space-between';
                    item.style.alignItems = 'center';
                    item.style.padding = '15px';
                    item.style.background = available ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                    item.style.borderRadius = '10px';
                    item.style.border = `1px solid ${available ? '#10b981' : '#ef4444'}`;
                    
                    item.innerHTML = `
                        <div>
                            <div style="font-weight: bold; color: white;">${product.name}</div>
                            <div style="font-size: 13px; color: #94a3b8;">R$ ${product.price.toFixed(2)}</div>
                            ${product.requiresFlavorSelection ? '<div style="font-size: 12px; color: #60a5fa; margin-top: 4px;">‚ö° Com sabores</div>' : ''}
                        </div>
                        <label style="position: relative; display: inline-block; width: 60px; height: 30px; cursor: pointer;">
                            <input type="checkbox" 
                                   style="opacity: 0; width: 0; height: 0; position: absolute;" 
                                   id="admin_toggle_${product.id}"
                                   ${available ? 'checked' : ''}
                                   onchange="adminToggleProductAvailability('${product.id}', this.checked)">
                            <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: ${available ? '#10b981' : '#dc2626'}; transition: .4s; border-radius: 30px; pointer-events: none;"></span>
                            <span style="position: absolute; content: ''; height: 22px; width: 22px; left: ${available ? '34px' : '4px'}; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; pointer-events: none;"></span>
                        </label>
                    `;
                    
                    grid.appendChild(item);
                });
                
                section.appendChild(grid);
                container.appendChild(section);
            });
        }

        function adminToggleProductAvailability(productId, isAvailable) {
            state.productAvailability[productId] = isAvailable;
            localStorage.setItem('bebcom_product_availability', JSON.stringify(state.productAvailability));
            
            const toggle = document.getElementById(`admin_toggle_${productId}`);
            if (toggle) {
                const span = toggle.nextElementSibling;
                const slider = span.nextElementSibling;
                if (span) span.style.backgroundColor = isAvailable ? '#10b981' : '#dc2626';
                if (slider) slider.style.left = isAvailable ? '34px' : '4px';
            }
            
            const product = findProductById(productId);
            const elements = document.querySelectorAll(`[data-product-id="${productId}"]`);
            
            elements.forEach(el => {
                if (isAvailable) {
                    el.classList.remove('unavailable');
                    const btn = el.querySelector('button');
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = product?.requiresFlavorSelection ? '‚ö° Escolher Sabores' : 'üõí Adicionar';
                    }
                } else {
                    el.classList.add('unavailable');
                    const btn = el.querySelector('button');
                    if (btn) {
                        btn.disabled = true;
                        btn.innerHTML = '‚ùå Indispon√≠vel';
                    }
                }
            });
            
            showNotification(`${product?.name || 'Produto'} ${isAvailable ? '‚úÖ dispon√≠vel' : '‚ùå indispon√≠vel'}`, 'info');
        }

        function setAllAvailable(isAvailable) {
            Object.keys(products).forEach(cat => {
                products[cat].forEach(p => {
                    state.productAvailability[p.id] = isAvailable;
                    
                    const toggle = document.getElementById(`admin_toggle_${p.id}`);
                    if (toggle) {
                        toggle.checked = isAvailable;
                        const span = toggle.nextElementSibling;
                        const slider = span.nextElementSibling;
                        if (span) span.style.backgroundColor = isAvailable ? '#10b981' : '#dc2626';
                        if (slider) slider.style.left = isAvailable ? '34px' : '4px';
                    }
                    
                    const elements = document.querySelectorAll(`[data-product-id="${p.id}"]`);
                    elements.forEach(el => {
                        if (isAvailable) {
                            el.classList.remove('unavailable');
                            const btn = el.querySelector('button');
                            if (btn) {
                                btn.disabled = false;
                                btn.innerHTML = p.requiresFlavorSelection ? '‚ö° Escolher Sabores' : 'üõí Adicionar';
                            }
                        } else {
                            el.classList.add('unavailable');
                            const btn = el.querySelector('button');
                            if (btn) {
                                btn.disabled = true;
                                btn.innerHTML = '‚ùå Indispon√≠vel';
                            }
                        }
                    });
                });
            });
            
            localStorage.setItem('bebcom_product_availability', JSON.stringify(state.productAvailability));
            showNotification(isAvailable ? '‚úÖ Todos dispon√≠veis' : '‚ùå Todos indispon√≠veis');
        }

        // ‚úÖ CORRIGIDO: Salvar no MongoDB AGORA FUNCIONA!
        async function saveAvailability() {
            if (!isAdminAuthenticated()) {
                showNotification('üîê Sess√£o expirada. Fa√ßa login novamente.', 'error');
                openAdminPanel();
                return;
            }
            
            const btn = document.querySelector('.save-btn');
            const original = btn.innerHTML;
            
            btn.innerHTML = '<span class="loading-spinner"></span> Salvando no servidor...';
            btn.disabled = true;
            
            try {
                // Sempre salva localmente primeiro
                localStorage.setItem('bebcom_product_availability', JSON.stringify(state.productAvailability));
                localStorage.setItem('bebcom_flavor_availability', JSON.stringify(state.flavorAvailability));
                
                // Tenta salvar no backend
                if (CONFIG.backendUrl) {
                    // Verifica se o backend est√° online
                    await checkBackendHealth();
                    
                    if (state.backendOnline) {
                        const headers = getAdminHeaders();
                        
                        // Salva produtos
                        const prodRes = await fetch(`${CONFIG.backendUrl}/api/admin/product-availability/bulk`, {
                            method: 'POST',
                            headers: headers,
                            body: JSON.stringify({ 
                                productAvailability: state.productAvailability,
                                adminName: 'Admin BebCom',
                                source: 'frontend'
                            })
                        });
                        
                        // Salva sabores
                        const flavRes = await fetch(`${CONFIG.backendUrl}/api/admin/flavor-availability/bulk`, {
                            method: 'POST',
                            headers: headers,
                            body: JSON.stringify({ 
                                flavorAvailability: state.flavorAvailability,
                                adminName: 'Admin BebCom',
                                source: 'frontend'
                            })
                        });
                        
                        if (prodRes.ok && flavRes.ok) {
                            showNotification('‚úÖ Dados salvos no servidor (MongoDB)!');
                            
                            // ‚úÖ RECARREGA a disponibilidade imediatamente
                            await loadAvailability();
                            
                            // ‚úÖ Fecha o painel ap√≥s 1.5 segundos
                            setTimeout(() => closeAdminPanel(), 1500);
                        } else {
                            const prodError = prodRes.ok ? '' : ' produtos';
                            const flavError = flavRes.ok ? '' : ' sabores';
                            showNotification(`‚ö†Ô∏è Erro ao salvar:${prodError}${flavError}. Dados salvos localmente.`, 'warning');
                            setTimeout(() => closeAdminPanel(), 2000);
                        }
                    } else {
                        showNotification('‚ö†Ô∏è Servidor offline. Dados salvos apenas localmente.', 'warning');
                        setTimeout(() => closeAdminPanel(), 2000);
                    }
                } else {
                    showNotification('‚ö†Ô∏è URL do servidor n√£o configurada. Dados salvos localmente.', 'warning');
                    setTimeout(() => closeAdminPanel(), 2000);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar:', error);
                showNotification('‚ùå Erro ao salvar no servidor. Dados mantidos localmente.', 'error');
                setTimeout(() => closeAdminPanel(), 2000);
            } finally {
                btn.innerHTML = original;
                btn.disabled = false;
            }
        }

        function resetAvailability() {
            if (confirm('Restaurar todos os produtos como dispon√≠veis?')) {
                Object.keys(products).forEach(cat => {
                    products[cat].forEach(p => {
                        state.productAvailability[p.id] = true;
                    });
                });
                
                Object.keys(FLAVOR_CATALOG).forEach(type => {
                    FLAVOR_CATALOG[type].forEach(flavor => {
                        state.flavorAvailability[`${type}_${flavor}`] = true;
                    });
                });
                
                localStorage.setItem('bebcom_product_availability', JSON.stringify(state.productAvailability));
                localStorage.setItem('bebcom_flavor_availability', JSON.stringify(state.flavorAvailability));
                
                if (document.getElementById('adminMain').style.display === 'block') {
                    loadAdminProducts();
                }
                
                updateMenuAvailability();
                showNotification('üîÑ Disponibilidade restaurada');
            }
        }

        async function syncAllFromServer() {
            if (!isAdminAuthenticated()) {
                showNotification('üîê Sess√£o expirada. Fa√ßa login novamente.', 'error');
                openAdminPanel();
                return;
            }
            
            const btn = document.querySelector('[onclick*="syncAllFromServer"]');
            const original = btn.innerHTML;
            
            btn.innerHTML = '<span class="loading-spinner"></span> Sincronizando do servidor...';
            btn.disabled = true;
            
            try {
                if (!CONFIG.backendUrl) {
                    showNotification('‚ùå URL do servidor n√£o configurada', 'error');
                    return;
                }
                
                await checkBackendHealth();
                
                if (state.backendOnline) {
                    const [productsRes, flavorsRes] = await Promise.all([
                        fetch(`${CONFIG.backendUrl}/api/product-availability`),
                        fetch(`${CONFIG.backendUrl}/api/flavor-availability`)
                    ]);
                    
                    let atualizado = false;
                    
                    if (productsRes.ok) {
                        const productData = await productsRes.json();
                        if (productData.success && productData.productAvailability) {
                            state.productAvailability = productData.productAvailability;
                            localStorage.setItem('bebcom_product_availability', JSON.stringify(state.productAvailability));
                            atualizado = true;
                        }
                    }
                    
                    if (flavorsRes.ok) {
                        const flavorData = await flavorsRes.json();
                        if (flavorData.success && flavorData.flavorAvailability) {
                            state.flavorAvailability = flavorData.flavorAvailability;
                            localStorage.setItem('bebcom_flavor_availability', JSON.stringify(state.flavorAvailability));
                            atualizado = true;
                        }
                    }
                    
                    if (atualizado) {
                        updateMenuAvailability();
                        if (document.getElementById('adminMain').style.display === 'block') {
                            loadAdminProducts();
                        }
                        showNotification('‚úÖ Dados sincronizados do servidor (MongoDB)!');
                    } else {
                        showNotification('‚ö†Ô∏è Nenhum dado encontrado no servidor', 'warning');
                    }
                } else {
                    showNotification('‚ö†Ô∏è Servidor offline. Mantendo dados locais.', 'warning');
                }
            } catch (error) {
                console.error('‚ùå Erro na sincroniza√ß√£o:', error);
                showNotification('‚ùå Erro ao sincronizar com o servidor', 'error');
            } finally {
                btn.innerHTML = original;
                btn.disabled = false;
            }
        }
     // ============================================
// GERENCIAMENTO DE SABORES - FUN√á√ïES FALTANTES!
// ============================================
function openFlavorManagement() {
    if (!isAdminAuthenticated()) {
        showNotification('üîê Sess√£o expirada. Fa√ßa login novamente.', 'error');
        openAdminPanel();
        return;
    }
    
    const container = document.getElementById('adminMain');
    container.innerHTML = `
        <div style="margin-bottom: 30px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                <button onclick="loadAdminProducts()" style="background: #3b82f6; color: white; border: none; border-radius: 8px; padding: 10px 15px; cursor: pointer;">
                    ‚Ü©Ô∏è Voltar
                </button>
                <h3 style="color: #60a5fa; margin: 0;">üçπ Gerenciar Sabores</h3>
            </div>
            
            <select id="flavorTypeSelect" style="width: 100%; padding: 15px; background: rgba(255,255,255,0.1); border: 1px solid #444; border-radius: 8px; color: white; margin-bottom: 20px;" onchange="loadFlavorsForType(this.value)">
                <option value="">-- Selecione um tipo --</option>
                ${Object.entries(FLAVOR_TYPES).map(([key, name]) => `<option value="${key}">${name}</option>`).join('')}
            </select>
            
            <div id="flavorManagementSection" style="display: none;"></div>
        </div>
    `;
}

function loadFlavorsForType(flavorType) {
    const section = document.getElementById('flavorManagementSection');
    
    if (!flavorType) {
        section.style.display = 'none';
        return;
    }
    
    const flavors = FLAVOR_CATALOG[flavorType] || [];
    const typeName = FLAVOR_TYPES[flavorType] || flavorType;
    
    let html = `
        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
            <h4 style="color: #94a3b8; margin-bottom: 15px;">Gerenciando: ${typeName}</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px;">
    `;
    
    flavors.forEach(flavor => {
        const key = `${flavorType}_${flavor}`;
        const available = state.flavorAvailability[key] !== false;
        
        html += `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: ${available ? 'rgba(16,185,129,0.1)' : 'rgba(239,68,68,0.1)'}; border-radius: 8px; border: 1px solid ${available ? '#10b981' : '#ef4444'};">
                <span style="color: white; font-weight: 500;">${flavor}</span>
                <label style="position: relative; display: inline-block; width: 50px; height: 24px;">
                    <input type="checkbox" style="opacity: 0; width: 0; height: 0;" 
                           ${available ? 'checked' : ''}
                           onchange="toggleFlavorAvailability('${flavorType}', '${flavor}', this.checked)">
                    <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: ${available ? '#10b981' : '#dc2626'}; transition: .4s; border-radius: 24px;"></span>
                    <span style="position: absolute; content: ''; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; transform: ${available ? 'translateX(26px)' : 'none'};"></span>
                </label>
            </div>
        `;
    });
    
    html += `
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="setAllFlavorsAvailable('${flavorType}', true)" style="flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer;">‚úÖ Todos</button>
                <button onclick="setAllFlavorsAvailable('${flavorType}', false)" style="flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer;">‚ùå Nenhum</button>
            </div>
        </div>
    `;
    
    section.innerHTML = html;
    section.style.display = 'block';
}

function toggleFlavorAvailability(flavorType, flavorName, isAvailable) {
    const key = `${flavorType}_${flavorName}`;
    state.flavorAvailability[key] = isAvailable;
    localStorage.setItem('bebcom_flavor_availability', JSON.stringify(state.flavorAvailability));
    loadFlavorsForType(flavorType);
    showNotification(`Sabor ${flavorName} ${isAvailable ? '‚úÖ dispon√≠vel' : '‚ùå indispon√≠vel'}`, 'info');
}

function setAllFlavorsAvailable(flavorType, makeAvailable) {
    const flavors = FLAVOR_CATALOG[flavorType] || [];
    flavors.forEach(flavor => {
        const key = `${flavorType}_${flavor}`;
        state.flavorAvailability[key] = makeAvailable;
    });
    localStorage.setItem('bebcom_flavor_availability', JSON.stringify(state.flavorAvailability));
    loadFlavorsForType(flavorType);
    showNotification(`Todos os sabores ${makeAvailable ? '‚úÖ dispon√≠veis' : '‚ùå indispon√≠veis'}`, 'info');
}
        function syncPendingData() {
            console.log('üîÑ Sincroniza√ß√£o pendente...');
        }

        function updateMenuAvailability() {
            Object.keys(products).forEach(cat => {
                products[cat].forEach(p => {
                    const elements = document.querySelectorAll(`[data-product-id="${p.id}"]`);
                    const available = isProductAvailable(p.id);
                    const hasFlavors = p.requiresFlavorSelection || false;
                    
                    elements.forEach(el => {
                        if (available) {
                            el.classList.remove('unavailable');
                            const btn = el.querySelector('button');
                            if (btn) {
                                btn.disabled = false;
                                btn.innerHTML = hasFlavors ? '‚ö° Escolher Sabores' : 'üõí Adicionar';
                            }
                        } else {
                            el.classList.add('unavailable');
                            const btn = el.querySelector('button');
                            if (btn) {
                                btn.disabled = true;
                                btn.innerHTML = '‚ùå Indispon√≠vel';
                            }
                        }
                    });
                });
            });
        }

        // ============================================
        // UTILIT√ÅRIOS
        // ============================================
        function setupEventListeners() {
            const inputs = ['customerName', 'customerPhone', 'street', 'number', 'neighborhood'];
            inputs.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('input', validateForm);
            });
            document.getElementById('number').addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
        }

        function setupPhoneMask() {
            const phone = document.getElementById('customerPhone');
            phone.addEventListener('input', function(e) {
                let v = e.target.value.replace(/\D/g, '');
                if (v.length > 11) v = v.substring(0, 11);
                if (v.length > 0) {
                    if (v.length <= 2) v = `(${v}`;
                    else if (v.length <= 6) v = `(${v.substring(0, 2)}) ${v.substring(2)}`;
                    else v = `(${v.substring(0, 2)}) ${v.substring(2, 6)}-${v.substring(6, 11)}`;
                }
                e.target.value = v;
                validateForm();
            });
        }

        function showNotification(msg, type = 'success') {
            const colors = { success: '#28a745', error: '#dc3545', warning: '#ffc107', info: '#17a2b8' };
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.style.cssText = `
                position: fixed; top: 20px; right: 20px; background: ${colors[type]};
                color: white; padding: 16px 24px; border-radius: 10px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.3); z-index: 10000;
                animation: slideIn 0.3s ease; font-weight: bold; max-width: 350px;
            `;
            notif.innerHTML = msg;
            document.body.appendChild(notif);
            setTimeout(() => { notif.style.animation = 'fadeIn 0.3s reverse'; setTimeout(() => notif.remove(), 300); }, 3000);
        }

        // ============================================
        // INICIALIZA√á√ÉO PRINCIPAL
        // ============================================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ BebCom Delivery - Azure Production');
            await loadSecureConfig();
            initStorage();
            initAdminSystem();
            initAgeVerification();
            setTimeout(checkBackendHealth, 2000);
        });
// ============================================
// EXPOR FUN√á√ïES GLOBAIS - ‚úÖ CORRIGIDO!
// ============================================
window.showCategory = showCategory;
window.handleAddToCart = handleAddToCart;
window.updateQuantity = updateQuantity;
window.removeFromCart = removeFromCart;
window.clearCart = clearCart;
window.selectDeliveryType = selectDeliveryType;
window.selectPaymentMethod = selectPaymentMethod;
window.processPayment = processPayment;
window.sendToWhatsApp = sendToWhatsApp;
window.confirmFlavorSelection = confirmFlavorSelection;
window.cancelFlavorSelection = cancelFlavorSelection;
window.checkAdminPassword = checkAdminPassword;
window.setAllAvailable = setAllAvailable;
window.saveAvailability = saveAvailability;
window.resetAvailability = resetAvailability;
window.openFlavorManagement = openFlavorManagement;        // ‚úÖ ADICIONADO!
window.loadFlavorsForType = loadFlavorsForType;            // ‚úÖ ADICIONADO!
window.toggleFlavorAvailability = toggleFlavorAvailability;
window.setAllFlavorsAvailable = setAllFlavorsAvailable;
window.syncAllFromServer = syncAllFromServer;
window.adminToggleProductAvailability = adminToggleProductAvailability;
window.loadAdminProducts = loadAdminProducts;
    </script>
</body>
</html>
