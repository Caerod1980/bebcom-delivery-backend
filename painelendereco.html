<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BebCom Admin - Painel de Pedidos</title>
    
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- SheetJS para exportar Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    
    <style>
        /* ESTILOS IGUAIS - MANTIDOS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
        }

        :root {
            --primary: #dc2626;
            --primary-dark: #b91c1c;
            --secondary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0a0a0a;
            --darker: #1a1a1a;
            --light: #f5f5f5;
            --gray: #94a3b8;
        }

        body {
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            border: 1px solid #333;
        }

        .header h1 {
            color: white;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header h1 span {
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .header-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-excel {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-csv {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .btn-import {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-refresh {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .btn-json {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .btn-import-json {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            color: white;
        }

        .btn-stats {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            color: white;
        }

        .header-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid #444;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .tab:hover {
            border-color: var(--secondary);
            background: rgba(59, 130, 246, 0.1);
        }

        .tab.active {
            background: var(--secondary);
            border-color: var(--secondary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(26, 26, 26, 0.95);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #333;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-title {
            color: var(--gray);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: white;
        }

        .stat-sub {
            font-size: 14px;
            color: var(--gray);
            margin-top: 10px;
        }

        .filter-section {
            background: rgba(26, 26, 26, 0.95);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.3);
            padding: 8px 15px;
            border-radius: 30px;
            border: 1px solid #444;
        }

        .filter-group label {
            color: var(--gray);
            font-size: 14px;
        }

        .filter-group select, .filter-group input {
            background: transparent;
            border: none;
            color: white;
            padding: 5px;
            font-size: 14px;
            outline: none;
        }

        .filter-group select option {
            background: var(--darker);
        }

        .filter-group input[type="date"] {
            color-scheme: dark;
        }

        .filter-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .reset-btn {
            background: #4b5563;
        }

        .table-container {
            background: rgba(26, 26, 26, 0.95);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #333;
            overflow-x: auto;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 15px 10px;
            color: var(--gray);
            font-weight: 600;
            font-size: 14px;
            border-bottom: 2px solid #333;
            cursor: pointer;
            transition: color 0.2s;
        }

        th:hover {
            color: var(--secondary);
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #333;
            font-size: 14px;
        }

        tr:hover td {
            background: rgba(59, 130, 246, 0.1);
        }

        .badge {
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-delivery {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid #3b82f6;
        }

        .badge-pickup {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }

        .badge-paid {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .badge-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .value-positive {
            color: #10b981;
            font-weight: 600;
        }

        .address-cell {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--gray);
            font-size: 12px;
        }

        .address-cell:hover {
            white-space: normal;
            overflow: visible;
            background: rgba(0,0,0,0.8);
            position: relative;
            z-index: 10;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid #444;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination button:hover {
            background: var(--secondary);
            border-color: var(--secondary);
        }

        .pagination button.active {
            background: var(--secondary);
            border-color: var(--secondary);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: var(--gray);
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .stats-footer {
            margin-top: 30px;
            text-align: center;
            color: var(--gray);
            font-size: 12px;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                text-align: center;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                üìä <span>BebCom</span> Admin Panel
                <small style="font-size: 14px; color: var(--gray); margin-left: 10px;">v4.2</small>
            </h1>
            <div class="header-actions">
                <button class="header-btn btn-refresh" onclick="refreshDashboard()">
                    üîÑ Atualizar
                </button>
                <button class="header-btn btn-excel" onclick="exportToExcel()">
                    üì• Exportar Excel
                </button>
                <button class="header-btn btn-csv" onclick="exportToCSV()">
                    üìÑ Exportar CSV
                </button>
                <button class="header-btn btn-json" onclick="exportToJSON()">
                    üì¶ Backup JSON
                </button>
                <button class="header-btn btn-import" onclick="importFromCSV()">
                    üì§ Importar CSV
                </button>
                <button class="header-btn btn-import-json" onclick="importFromJSON()">
                    üì§ Importar JSON
                </button>
                <button class="header-btn btn-stats" onclick="showQuickStats()">
                    ‚ö° Stats R√°pidas
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</div>
            <div class="tab" onclick="switchTab('orders')">üìã Pedidos</div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <!-- Filtros do Dashboard -->
            <div class="filter-section">
                <div class="filter-group">
                    <label>üìÖ Per√≠odo:</label>
                    <select id="dashboardPeriodFilter" onchange="applyDashboardFilters()">
                        <option value="today">Hoje</option>
                        <option value="yesterday">Ontem</option>
                        <option value="week" selected>√öltimos 7 dias</option>
                        <option value="month">Este m√™s</option>
                        <option value="lastMonth">M√™s passado</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
                
                <div id="dashboardCustomDateRange" style="display: none; gap: 10px;">
                    <div class="filter-group">
                        <label>De:</label>
                        <input type="date" id="dashboardStartDate">
                    </div>
                    <div class="filter-group">
                        <label>At√©:</label>
                        <input type="date" id="dashboardEndDate">
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>üì¶ Tipo:</label>
                    <select id="dashboardTypeFilter" onchange="applyDashboardFilters()">
                        <option value="all">Todos</option>
                        <option value="delivery">Entrega</option>
                        <option value="pickup">Retirada</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>üí≥ Status:</label>
                    <select id="dashboardStatusFilter" onchange="applyDashboardFilters()">
                        <option value="all">Todos</option>
                        <option value="paid">Pagos</option>
                        <option value="pending">Pendentes</option>
                    </select>
                </div>
                
                <button class="filter-btn" onclick="applyDashboardFilters()">Aplicar Filtros</button>
                <button class="filter-btn reset-btn" onclick="resetDashboardFilters()">Resetar</button>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" id="statsCards">
                <div class="stat-card">
                    <div class="loading" style="padding: 20px;">Carregando...</div>
                </div>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="orders-tab" class="tab-content">
            <!-- Filtros -->
            <div class="filter-section">
                <div class="filter-group">
                    <label>üìÖ Per√≠odo:</label>
                    <select id="periodFilter" onchange="applyFilters()">
                        <option value="today">Hoje</option>
                        <option value="yesterday">Ontem</option>
                        <option value="week" selected>√öltimos 7 dias</option>
                        <option value="month">Este m√™s</option>
                        <option value="lastMonth">M√™s passado</option>
                        <option value="custom">Personalizado</option>
                    </select>
                </div>
                
                <div id="customDateRange" style="display: none; gap: 10px;">
                    <div class="filter-group">
                        <label>De:</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="filter-group">
                        <label>At√©:</label>
                        <input type="date" id="endDate">
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>üì¶ Tipo:</label>
                    <select id="typeFilter" onchange="applyFilters()">
                        <option value="all">Todos</option>
                        <option value="delivery">Entrega</option>
                        <option value="pickup">Retirada</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>üí≥ Status:</label>
                    <select id="statusFilter" onchange="applyFilters()">
                        <option value="all">Todos</option>
                        <option value="paid">Pagos</option>
                        <option value="pending">Pendentes</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>üîç Buscar:</label>
                    <input type="text" id="searchFilter" placeholder="Nome, WhatsApp ou ID..." onkeyup="applyFilters()">
                </div>
                
                <button class="filter-btn" onclick="applyFilters()">Aplicar Filtros</button>
                <button class="filter-btn reset-btn" onclick="resetFilters()">Resetar</button>
            </div>

            <!-- Orders Table -->
            <div class="table-container">
                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th onclick="sortBy('id')">ID do Pedido üìã</th>
                            <th onclick="sortBy('date')">Data/Hora ‚è∞</th>
                            <th onclick="sortBy('customer.name')">Cliente üë§</th>
                            <th onclick="sortBy('customer.phone')">WhatsApp üì±</th>
                            <th onclick="sortBy('customer.email')">E-mail ‚úâÔ∏è</th>
                            <th>Endere√ßo üìç</th>
                            <th onclick="sortBy('total')">Valor Total üí∞</th>
                            <th onclick="sortBy('deliveryFee')">Taxa üöö</th>
                            <th onclick="sortBy('type')">Tipo üì¶</th>
                            <th onclick="sortBy('paymentConfirmed')">Status üí≥</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="10" class="loading">
                                <div class="loading-spinner"></div>
                                <div>Carregando pedidos...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="pagination" id="pagination">
                    <button onclick="changePage('prev')" id="prevPage">‚Üê Anterior</button>
                    <span id="pageInfo" style="color: var(--gray); padding: 8px;">P√°gina 1</span>
                    <button onclick="changePage('next')" id="nextPage">Pr√≥xima ‚Üí</button>
                </div>
            </div>
        </div>

        <div class="stats-footer">
            BebCom Delivery - Painel Administrativo ‚Ä¢ Dados centralizados no servidor
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ÉO E ESTADO GLOBAL
        // ============================================
        const API_BASE_URL = 'https://bebcom-delivery-api-1980-bchkauhjf0djajag.brazilsouth-01.azurewebsites.net';
        const DB_NAME = 'BebComOrders';
        const DB_VERSION = 2;
        const STORE_NAME = 'orders';
        
        let db = null;
        let allOrders = [];
        let filteredOrders = [];
        let currentPage = 1;
        const ITEMS_PER_PAGE = 15;
        let currentSort = { field: 'date', direction: 'desc' };

        // ============================================
        // INICIALIZAR BANCO DE DADOS (FALLBACK)
        // ============================================
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => {
                    console.error('Erro ao abrir banco:', request.error);
                    reject(request.error);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('‚úÖ Banco IndexedDB aberto (fallback)');
                    migrateFromLocalStorage();
                    resolve();
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const store = db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                        store.createIndex('by_date', 'date', { unique: false });
                        store.createIndex('by_timestamp', 'timestamp', { unique: false });
                        store.createIndex('by_type', 'type', { unique: false });
                        store.createIndex('by_customer_name', 'customer.name', { unique: false });
                        store.createIndex('by_payment_status', 'paymentConfirmed', { unique: false });
                        console.log('‚úÖ Estrutura do banco IndexedDB criada');
                    }
                };
            });
        }

        // ============================================
        // MIGRAR DADOS DO LOCALSTORAGE
        // ============================================
        function migrateFromLocalStorage() {
            try {
                const backup = localStorage.getItem('bebcom_orders_backup');
                if (backup) {
                    const orders = JSON.parse(backup);
                    if (orders.length > 0) {
                        console.log(`üì¶ Encontrados ${orders.length} pedidos no localStorage`);
                        orders.forEach(order => saveOrder(order));
                        localStorage.removeItem('bebcom_orders_backup');
                        showNotification(`‚úÖ ${orders.length} pedidos migrados`, 'success');
                    }
                }
            } catch (e) {
                console.warn('Erro na migra√ß√£o:', e);
            }
        }

        // ============================================
        // SALVAR PEDIDO (FALLBACK)
        // ============================================
        function saveOrder(orderData) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    saveToLocalStorage(orderData);
                    resolve();
                    return;
                }
                
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                
                const order = {
                    ...orderData,
                    id: orderData.id || orderData.orderId || 'BEB' + Date.now(),
                    timestamp: orderData.timestamp || Date.now()
                };
                
                const request = store.put(order);
                
                request.onsuccess = () => resolve();
                request.onerror = () => {
                    saveToLocalStorage(orderData);
                    reject(request.error);
                };
            });
        }

        function saveToLocalStorage(orderData) {
            try {
                const saved = localStorage.getItem('bebcom_orders_backup') || '[]';
                const orders = JSON.parse(saved);
                orders.push(orderData);
                localStorage.setItem('bebcom_orders_backup', JSON.stringify(orders.slice(-1000)));
            } catch (e) {
                console.error('Erro no fallback:', e);
            }
        }

        // ============================================
        // CARREGAR PEDIDOS DO BACKEND
        // ============================================
        async function loadAllOrders() {
            try {
                showNotification('üîÑ Buscando pedidos do servidor...', 'info');
                
                // Construir URL com filtros atuais
                const type = document.getElementById('typeFilter')?.value || 'all';
                const status = document.getElementById('statusFilter')?.value || 'all';
                const search = document.getElementById('searchFilter')?.value || '';
                
                let url = `${API_BASE_URL}/api/admin/orders?limit=1000`;
                if (type !== 'all') url += `&type=${type}`;
                if (status !== 'all') url += `&status=${status}`;
                if (search) url += `&search=${encodeURIComponent(search)}`;
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.orders) {
                    allOrders = data.orders.map(order => {
                        return {
                            id: order.orderId || order._id,
                            date: order.createdAt,
                            timestamp: new Date(order.createdAt).getTime(),
                            customer: order.customer || {},
                            type: order.deliveryType || 'pickup',
                            items: order.items || [],
                            subtotal: order.items?.reduce((s, i) => s + (i.quantity * i.unit_price), 0) || 0,
                            deliveryFee: order.deliveryFee || 0,
                            total: order.total || 0,
                            address: order.address || null,
                            paymentConfirmed: order.status === 'approved',
                            status: order.status,
                            distance: order.distance
                        };
                    });
                    
                    console.log(`üì¶ ${allOrders.length} pedidos carregados do servidor`);
                    
                    // Salvar backup local
                    saveLocalBackup(allOrders);
                    
                    return allOrders;
                } else {
                    throw new Error('Resposta inv√°lida da API');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar do servidor:', error);
                showNotification('‚ö†Ô∏è Servidor offline, usando dados locais', 'warning');
                
                // Fallback para IndexedDB
                return loadFromIndexedDB();
            }
        }

        // ============================================
        // FALLBACK: CARREGAR DO INDEXEDDB
        // ============================================
        function loadFromIndexedDB() {
            return new Promise((resolve) => {
                if (!db) {
                    try {
                        const backup = localStorage.getItem('bebcom_orders_backup') || '[]';
                        allOrders = JSON.parse(backup);
                        resolve(allOrders);
                    } catch {
                        allOrders = [];
                        resolve([]);
                    }
                    return;
                }
                
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.getAll();
                
                request.onsuccess = () => {
                    allOrders = request.result || [];
                    allOrders.sort((a, b) => {
                        const dateA = new Date(a.date || a.timestamp).getTime();
                        const dateB = new Date(b.date || b.timestamp).getTime();
                        return dateB - dateA;
                    });
                    resolve(allOrders);
                };
                
                request.onerror = () => {
                    allOrders = [];
                    resolve([]);
                };
            });
        }

        // ============================================
        // SALVAR BACKUP LOCAL
        // ============================================
        function saveLocalBackup(orders) {
            try {
                localStorage.setItem('bebcom_orders_backup', JSON.stringify(orders.slice(-1000)));
            } catch (e) {
                // Ignorar erro de quota
            }
        }

        // ============================================
        // FUN√á√ÉO PARA FORMATAR ENDERE√áO
        // ============================================
        function formatAddress(order) {
            if (order.type !== 'delivery' || !order.address) {
                return '<span style="color: #666;">üõí Retirada</span>';
            }
            
            const addr = order.address;
            const parts = [];
            
            if (addr.street) parts.push(addr.street);
            if (addr.number) parts.push(`, ${addr.number}`);
            if (addr.neighborhood) parts.push(` - ${addr.neighborhood}`);
            if (addr.city) parts.push(`, ${addr.city}`);
            if (addr.complement) parts.push(` (${addr.complement})`);
            
            return parts.join('').substring(0, 50) + (parts.join('').length > 50 ? '...' : '');
        }

        // ============================================
        // ADICIONAR DADOS DE EXEMPLO
        // ============================================
        function addExampleOrders() {
            const examples = [
                {
                    id: 'BEB' + (Date.now() - 86400000),
                    date: new Date(Date.now() - 86400000).toISOString(),
                    timestamp: Date.now() - 86400000,
                    customer: { name: 'Jo√£o Silva', phone: '(14) 99999-1111', email: 'joao@email.com' },
                    type: 'delivery',
                    address: {
                        street: 'Rua das Flores',
                        number: '123',
                        neighborhood: 'Centro',
                        city: 'Bauru',
                        complement: 'Apto 45'
                    },
                    items: [{ title: 'Heineken', quantity: 6, unit_price: 6.50 }],
                    subtotal: 39.00,
                    deliveryFee: 5.00,
                    total: 44.00,
                    paymentConfirmed: true,
                    status: 'approved'
                },
                {
                    id: 'BEB' + (Date.now() - 172800000),
                    date: new Date(Date.now() - 172800000).toISOString(),
                    timestamp: Date.now() - 172800000,
                    customer: { name: 'Maria Santos', phone: '(14) 98888-2222', email: 'maria@email.com' },
                    type: 'pickup',
                    address: null,
                    items: [{ title: 'Skol', quantity: 12, unit_price: 4.25 }],
                    subtotal: 51.00,
                    deliveryFee: 0,
                    total: 51.00,
                    paymentConfirmed: true,
                    status: 'approved'
                },
                {
                    id: 'BEB' + (Date.now() - 259200000),
                    date: new Date(Date.now() - 259200000).toISOString(),
                    timestamp: Date.now() - 259200000,
                    customer: { name: 'Pedro Oliveira', phone: '(14) 97777-3333', email: 'pedro@email.com' },
                    type: 'delivery',
                    address: {
                        street: 'Av. Rodrigues Alves',
                        number: '1560',
                        neighborhood: 'Jardim Am√©rica',
                        city: 'Bauru',
                        complement: ''
                    },
                    items: [{ title: 'Whisky Red Label', quantity: 2, unit_price: 25.00 }],
                    subtotal: 50.00,
                    deliveryFee: 8.50,
                    total: 58.50,
                    paymentConfirmed: false,
                    status: 'pending'
                }
            ];
            
            examples.forEach(order => saveOrder(order));
            showNotification('‚úÖ Pedidos de exemplo adicionados!', 'success');
        }

        // ============================================
        // ATUALIZAR DASHBOARD
        // ============================================
        async function refreshDashboard() {
            showNotification('üîÑ Atualizando dados...', 'info');
            await loadAllOrders();
            
            if (allOrders.length === 0) {
                addExampleOrders();
                await loadAllOrders();
            }
            
            applyDashboardFilters();
            showNotification('‚úÖ Dados atualizados!', 'success');
        }

        // ============================================
        // APLICAR FILTROS DO DASHBOARD
        // ============================================
        function applyDashboardFilters() {
            const period = document.getElementById('dashboardPeriodFilter').value;
            const type = document.getElementById('dashboardTypeFilter').value;
            const status = document.getElementById('dashboardStatusFilter').value;
            
            let start = null;
            let end = null;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (period === 'today') {
                start = new Date(today);
                end = new Date(today);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'yesterday') {
                start = new Date(today);
                start.setDate(start.getDate() - 1);
                end = new Date(start);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'week') {
                start = new Date(today);
                start.setDate(start.getDate() - 7);
                end = new Date(today);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'month') {
                start = new Date(today.getFullYear(), today.getMonth(), 1);
                end = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'lastMonth') {
                start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                end = new Date(today.getFullYear(), today.getMonth(), 0);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'custom') {
                const startDate = document.getElementById('dashboardStartDate').value;
                const endDate = document.getElementById('dashboardEndDate').value;
                if (startDate && endDate) {
                    start = new Date(startDate + 'T00:00:00');
                    end = new Date(endDate + 'T23:59:59');
                }
            }
            
            // Filtrar pedidos
            const filtered = allOrders.filter(order => {
                const orderDate = new Date(order.date || order.timestamp);
                
                if (start && end && (orderDate < start || orderDate > end)) return false;
                if (type !== 'all' && order.type !== type) return false;
                if (status === 'paid' && !order.paymentConfirmed) return false;
                if (status === 'pending' && order.paymentConfirmed) return false;
                
                return true;
            });
            
            updateStats(filtered);
        }

        // ============================================
        // ATUALIZAR ESTAT√çSTICAS
        // ============================================
        function updateStats(filteredOrders) {
            const count = filteredOrders.length;
            const total = filteredOrders.reduce((sum, o) => sum + (o.total || 0), 0);
            const ticket = count > 0 ? total / count : 0;
            const deliveries = filteredOrders.filter(o => o.type === 'delivery').length;
            const pickups = filteredOrders.filter(o => o.type === 'pickup').length;
            const paid = filteredOrders.filter(o => o.paymentConfirmed).length;
            const pending = count - paid;
            
            const statsHtml = `
                <div class="stat-card">
                    <div class="stat-title">üí∞ Faturamento</div>
                    <div class="stat-value">R$ ${total.toFixed(2)}</div>
                    <div class="stat-sub">${count} pedidos no per√≠odo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">üì¶ Pedidos por Tipo</div>
                    <div class="stat-value">${deliveries} / ${pickups}</div>
                    <div class="stat-sub">${deliveries} entregas ‚Ä¢ ${pickups} retiradas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">üí≥ Status de Pagamento</div>
                    <div class="stat-value">${paid} / ${pending}</div>
                    <div class="stat-sub">${paid} pagos ‚Ä¢ ${pending} pendentes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">üéØ Ticket M√©dio</div>
                    <div class="stat-value">R$ ${ticket.toFixed(2)}</div>
                    <div class="stat-sub">Por pedido no per√≠odo</div>
                </div>
            `;
            
            document.getElementById('statsCards').innerHTML = statsHtml;
        }

        // ============================================
        // RESETAR FILTROS DO DASHBOARD
        // ============================================
        function resetDashboardFilters() {
            document.getElementById('dashboardPeriodFilter').value = 'week';
            document.getElementById('dashboardTypeFilter').value = 'all';
            document.getElementById('dashboardStatusFilter').value = 'all';
            document.getElementById('dashboardCustomDateRange').style.display = 'none';
            document.getElementById('dashboardStartDate').value = '';
            document.getElementById('dashboardEndDate').value = '';
            applyDashboardFilters();
        }

        // ============================================
        // APLICAR FILTROS DA TABELA
        // ============================================
        function applyFilters() {
            const period = document.getElementById('periodFilter').value;
            const type = document.getElementById('typeFilter').value;
            const status = document.getElementById('statusFilter').value;
            const search = document.getElementById('searchFilter').value.toLowerCase();
            
            let start = null;
            let end = null;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (period === 'today') {
                start = new Date(today);
                end = new Date(today);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'yesterday') {
                start = new Date(today);
                start.setDate(start.getDate() - 1);
                end = new Date(start);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'week') {
                start = new Date(today);
                start.setDate(start.getDate() - 7);
                end = new Date(today);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'month') {
                start = new Date(today.getFullYear(), today.getMonth(), 1);
                end = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'lastMonth') {
                start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                end = new Date(today.getFullYear(), today.getMonth(), 0);
                end.setHours(23, 59, 59, 999);
            } else if (period === 'custom') {
                document.getElementById('customDateRange').style.display = 'flex';
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                if (startDate && endDate) {
                    start = new Date(startDate + 'T00:00:00');
                    end = new Date(endDate + 'T23:59:59');
                }
            }
            
            filteredOrders = allOrders.filter(order => {
                const orderDate = new Date(order.date || order.timestamp);
                
                if (start && end && (orderDate < start || orderDate > end)) return false;
                if (type !== 'all' && order.type !== type) return false;
                if (status === 'paid' && !order.paymentConfirmed) return false;
                if (status === 'pending' && order.paymentConfirmed) return false;
                
                if (search) {
                    const name = (order.customer?.name || '').toLowerCase();
                    const phone = (order.customer?.phone || '').toLowerCase();
                    const email = (order.customer?.email || '').toLowerCase();
                    const id = (order.id || '').toLowerCase();
                    if (!name.includes(search) && !phone.includes(search) && !email.includes(search) && !id.includes(search)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            sortOrders();
            currentPage = 1;
            renderTable();
            updatePagination();
        }

        // ============================================
        // ORDENAR PEDIDOS
        // ============================================
        function sortBy(field) {
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'asc';
            }
            sortOrders();
            renderTable();
        }

        function sortOrders() {
            filteredOrders.sort((a, b) => {
                let valA, valB;
                
                if (currentSort.field.includes('.')) {
                    const parts = currentSort.field.split('.');
                    valA = a[parts[0]]?.[parts[1]];
                    valB = b[parts[0]]?.[parts[1]];
                } else {
                    valA = a[currentSort.field];
                    valB = b[currentSort.field];
                }
                
                if (currentSort.field === 'date' || currentSort.field === 'timestamp') {
                    valA = new Date(valA || a.timestamp).getTime();
                    valB = new Date(valB || b.timestamp).getTime();
                }
                
                if (valA === undefined) valA = '';
                if (valB === undefined) valB = '';
                
                if (typeof valA === 'string') valA = valA.toLowerCase();
                if (typeof valB === 'string') valB = valB.toLowerCase();
                
                if (valA < valB) return currentSort.direction === 'asc' ? -1 : 1;
                if (valA > valB) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
        }

        // ============================================
        // RENDERIZAR TABELA
        // ============================================
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            
            if (filteredOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 50px;">üïí Nenhum pedido encontrado</td></tr>';
                return;
            }
            
            const start = (currentPage - 1) * ITEMS_PER_PAGE;
            const end = start + ITEMS_PER_PAGE;
            const pageOrders = filteredOrders.slice(start, end);
            
            tbody.innerHTML = pageOrders.map(order => {
                const date = new Date(order.date || order.timestamp);
                const formattedDate = date.toLocaleString('pt-BR');
                const typeClass = order.type === 'delivery' ? 'badge-delivery' : 'badge-pickup';
                const typeText = order.type === 'delivery' ? 'Entrega' : 'Retirada';
                const statusClass = order.paymentConfirmed ? 'badge-paid' : 'badge-pending';
                const statusText = order.paymentConfirmed ? 'Pago' : 'Pendente';
                const endereco = formatAddress(order);
                
                return `
                    <tr>
                        <td><strong>${order.id}</strong></td>
                        <td>${formattedDate}</td>
                        <td>${order.customer?.name || 'N/A'}</td>
                        <td>${order.customer?.phone || 'N/A'}</td>
                        <td>${order.customer?.email || 'N/A'}</td>
                        <td class="address-cell" title="${endereco.replace(/<[^>]*>/g, '')}">${endereco}</td>
                        <td class="value-positive">R$ ${(order.total || 0).toFixed(2)}</td>
                        <td>R$ ${(order.deliveryFee || 0).toFixed(2)}</td>
                        <td><span class="badge ${typeClass}">${typeText}</span></td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            }).join('');
        }

        // ============================================
        // PAGINA√á√ÉO
        // ============================================
        function updatePagination() {
            const totalPages = Math.ceil(filteredOrders.length / ITEMS_PER_PAGE);
            document.getElementById('pageInfo').textContent = `P√°gina ${currentPage} de ${totalPages || 1}`;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages || totalPages === 0;
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredOrders.length / ITEMS_PER_PAGE);
            if (direction === 'prev' && currentPage > 1) currentPage--;
            else if (direction === 'next' && currentPage < totalPages) currentPage++;
            renderTable();
            updatePagination();
        }

        // ============================================
        // TABS
        // ============================================
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'orders') {
                applyFilters();
                renderTable();
                updatePagination();
            }
        }

        // ============================================
        // A√á√ïES DE PEDIDO
        // ============================================
        function viewOrderDetails(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            const items = order.items || [];
            const itemsList = items.map(item => `‚Ä¢ ${item.quantity}x ${item.title} - R$ ${(item.quantity * item.unit_price).toFixed(2)}`).join('\n');
            
            let enderecoMsg = '';
            if (order.type === 'delivery' && order.address) {
                const addr = order.address;
                enderecoMsg = `
üìç ENDERE√áO DE ENTREGA:
${addr.street || ''}, ${addr.number || ''}
${addr.neighborhood || ''} - ${addr.city || 'Bauru'}
${addr.complement ? `Complemento: ${addr.complement}` : ''}
üìè Dist√¢ncia: ${order.distance ? order.distance.toFixed(1) + 'km' : 'N/A'}
`;
            }
            
            alert(`
                üçπ Pedido: ${order.id}
                üë§ Cliente: ${order.customer?.name || 'N/A'}
                üì± WhatsApp: ${order.customer?.phone || 'N/A'}
                ‚úâÔ∏è E-mail: ${order.customer?.email || 'N/A'}
                
                ${enderecoMsg}
                
                üõí ITENS:
                ${itemsList || 'Nenhum item'}
                
                üí∞ Subtotal: R$ ${(order.subtotal || 0).toFixed(2)}
                üöö Taxa: R$ ${(order.deliveryFee || 0).toFixed(2)}
                üíµ TOTAL: R$ ${(order.total || 0).toFixed(2)}
                
                üì¶ Tipo: ${order.type === 'delivery' ? 'Entrega' : 'Retirada'}
                üí≥ Pagamento: ${order.paymentConfirmed ? 'Pago' : 'Pendente'}
                üìÖ Data: ${new Date(order.date || order.timestamp).toLocaleString('pt-BR')}
            `);
        }

        // ============================================
        // EXPORTA√á√ÉO E IMPORTA√á√ÉO
        // ============================================
        function exportToCSV() {
            if (allOrders.length === 0) {
                showNotification('‚ùå Nenhum pedido para exportar', 'error');
                return;
            }
            
            const headers = ['ID', 'Data', 'Cliente', 'WhatsApp', 'E-mail', 'Endere√ßo', 'Tipo', 'Subtotal', 'Taxa', 'Total', 'Status'];
            const rows = [headers];
            
            allOrders.forEach(order => {
                const endereco = order.type === 'delivery' && order.address 
                    ? `${order.address.street || ''}, ${order.address.number || ''} - ${order.address.neighborhood || ''} ${order.address.complement ? `(${order.address.complement})` : ''}`.trim()
                    : 'Retirada';
                
                rows.push([
                    order.id,
                    new Date(order.date || order.timestamp).toLocaleString('pt-BR'),
                    order.customer?.name || '',
                    order.customer?.phone || '',
                    order.customer?.email || '',
                    endereco,
                    order.type === 'delivery' ? 'Entrega' : 'Retirada',
                    (order.subtotal || 0).toFixed(2),
                    (order.deliveryFee || 0).toFixed(2),
                    (order.total || 0).toFixed(2),
                    order.paymentConfirmed ? 'Pago' : 'Pendente'
                ]);
            });
            
            const csv = rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')).join('\n');
            const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bebcom_pedidos_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            showNotification('‚úÖ CSV exportado!', 'success');
        }

        function exportToExcel() {
            if (allOrders.length === 0) {
                showNotification('‚ùå Nenhum pedido para exportar', 'error');
                return;
            }
            
            const data = allOrders.map(order => {
                const endereco = order.type === 'delivery' && order.address 
                    ? `${order.address.street || ''}, ${order.address.number || ''} - ${order.address.neighborhood || ''} ${order.address.complement ? `(${order.address.complement})` : ''}`.trim()
                    : 'Retirada';
                
                return {
                    'ID': order.id,
                    'Data': new Date(order.date || order.timestamp).toLocaleString('pt-BR'),
                    'Cliente': order.customer?.name || '',
                    'WhatsApp': order.customer?.phone || '',
                    'E-mail': order.customer?.email || '',
                    'Endere√ßo': endereco,
                    'Tipo': order.type === 'delivery' ? 'Entrega' : 'Retirada',
                    'Subtotal': (order.subtotal || 0).toFixed(2),
                    'Taxa Entrega': (order.deliveryFee || 0).toFixed(2),
                    'Total': (order.total || 0).toFixed(2),
                    'Status': order.paymentConfirmed ? 'Pago' : 'Pendente'
                };
            });
            
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Pedidos');
            XLSX.writeFile(wb, `bebcom_pedidos_${new Date().toISOString().split('T')[0]}.xlsx`);
            showNotification('‚úÖ Excel exportado!', 'success');
        }

        function exportToJSON() {
            if (allOrders.length === 0) {
                showNotification('‚ùå Nenhum pedido para exportar', 'error');
                return;
            }
            
            const data = {
                exportedAt: new Date().toISOString(),
                totalOrders: allOrders.length,
                totalRevenue: allOrders.reduce((s, o) => s + (o.total || 0), 0),
                orders: allOrders
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bebcom_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showNotification('‚úÖ Backup JSON exportado!', 'success');
        }

        function importFromCSV() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = async (event) => {
                    let csv = event.target.result;
                    if (csv.charCodeAt(0) === 0xFEFF) csv = csv.substring(1);
                    
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
                    
                    let imported = 0;
                    
                    for (let i = 1; i < lines.length; i++) {
                        if (!lines[i].trim()) continue;
                        
                        try {
                            const values = lines[i].match(/(".*?"|[^,]+)(?=\s*,|\s*$)/g) || [];
                            const cleanValues = values.map(v => v.replace(/^"|"$/g, '').trim());
                            
                            const order = { 
                                customer: {},
                                address: {}
                            };
                            
                            headers.forEach((header, index) => {
                                const value = cleanValues[index] || '';
                                
                                if (header === 'ID') order.id = value;
                                else if (header === 'Data') {
                                    try {
                                        const parts = value.match(/(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2})/);
                                        if (parts) {
                                            order.date = new Date(parts[3], parts[2]-1, parts[1], parts[4], parts[5]).toISOString();
                                            order.timestamp = new Date(parts[3], parts[2]-1, parts[1], parts[4], parts[5]).getTime();
                                        }
                                    } catch {
                                        order.date = new Date().toISOString();
                                        order.timestamp = Date.now();
                                    }
                                } else if (header === 'Cliente') order.customer.name = value;
                                else if (header === 'WhatsApp') order.customer.phone = value;
                                else if (header === 'E-mail') order.customer.email = value;
                                else if (header === 'Endere√ßo') {
                                    if (value !== 'Retirada') {
                                        order.type = 'delivery';
                                        order.address.street = value;
                                    } else {
                                        order.type = 'pickup';
                                    }
                                } else if (header === 'Tipo') order.type = value === 'Entrega' ? 'delivery' : 'pickup';
                                else if (header === 'Total') order.total = parseFloat(value) || 0;
                                else if (header === 'Taxa Entrega') order.deliveryFee = parseFloat(value) || 0;
                                else if (header === 'Subtotal') order.subtotal = parseFloat(value) || 0;
                                else if (header === 'Status') order.paymentConfirmed = value === 'Pago';
                            });
                            
                            if (!order.id) order.id = 'IMP' + Date.now() + i;
                            order.items = order.items || [{ title: 'Item importado', quantity: 1, unit_price: order.total || 0 }];
                            
                            await saveOrder(order);
                            imported++;
                        } catch (err) {
                            console.error('Erro ao importar linha', i, err);
                        }
                    }
                    
                    showNotification(`‚úÖ ${imported} pedidos importados!`, 'success');
                    refreshDashboard();
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function importFromJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = async (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        let imported = 0;
                        
                        if (data.orders && Array.isArray(data.orders)) {
                            for (const order of data.orders) {
                                await saveOrder(order);
                                imported++;
                            }
                        } else if (Array.isArray(data)) {
                            for (const order of data) {
                                await saveOrder(order);
                                imported++;
                            }
                        }
                        
                        showNotification(`‚úÖ ${imported} pedidos importados!`, 'success');
                        refreshDashboard();
                    } catch (err) {
                        showNotification('‚ùå Erro ao importar JSON', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // ============================================
        // STATS R√ÅPIDAS
        // ============================================
        function showQuickStats() {
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const pedidosHoje = allOrders.filter(o => {
                const d = new Date(o.date || o.timestamp);
                return d >= hoje;
            }).length;
            
            const faturamentoHoje = allOrders
                .filter(o => {
                    const d = new Date(o.date || o.timestamp);
                    return d >= hoje;
                })
                .reduce((s, o) => s + (o.total || 0), 0);
            
            const pedidosPendentes = allOrders.filter(o => !o.paymentConfirmed).length;
            const ticketMedio = allOrders.length > 0 
                ? allOrders.reduce((s, o) => s + (o.total || 0), 0) / allOrders.length 
                : 0;
            
            alert(`
                üìä ESTAT√çSTICAS R√ÅPIDAS
                
                üì¶ Pedidos hoje: ${pedidosHoje}
                üí∞ Faturamento hoje: R$ ${faturamentoHoje.toFixed(2)}
                
                üïí Pedidos pendentes: ${pedidosPendentes}
                üíµ Ticket m√©dio: R$ ${ticketMedio.toFixed(2)}
                
                üìà Total geral: ${allOrders.length} pedidos
                üí∞ Faturamento total: R$ ${allOrders.reduce((s, o) => s + (o.total || 0), 0).toFixed(2)}
            `);
        }

        // ============================================
        // NOTIFICA√á√ïES
        // ============================================
        function showNotification(msg, type = 'success') {
            const colors = { success: '#10b981', error: '#ef4444', warning: '#f59e0b', info: '#3b82f6' };
            
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.style.backgroundColor = colors[type];
            notif.innerHTML = msg;
            
            document.body.appendChild(notif);
            
            setTimeout(() => {
                notif.style.animation = 'slideIn 0.3s reverse';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        async function init() {
            showNotification('üîÑ Carregando dados...', 'info');
            
            // Inicializar IndexedDB como fallback (opcional)
            try {
                await initDB();
            } catch (e) {
                console.log('IndexedDB n√£o dispon√≠vel, usando apenas localStorage como fallback');
            }
            
            await refreshDashboard();
            
            // Configurar listeners para datas customizadas
            document.getElementById('periodFilter')?.addEventListener('change', function() {
                document.getElementById('customDateRange').style.display = this.value === 'custom' ? 'flex' : 'none';
            });
            
            document.getElementById('dashboardPeriodFilter')?.addEventListener('change', function() {
                document.getElementById('dashboardCustomDateRange').style.display = this.value === 'custom' ? 'flex' : 'none';
            });
            
            showNotification('‚úÖ Painel carregado!', 'success');
        }

        // Iniciar
        init();

        // Expor fun√ß√µes globais
        window.switchTab = switchTab;
        window.applyFilters = applyFilters;
        window.applyDashboardFilters = applyDashboardFilters;
        window.resetFilters = resetFilters;
        window.resetDashboardFilters = resetDashboardFilters;
        window.sortBy = sortBy;
        window.changePage = changePage;
        window.viewOrderDetails = viewOrderDetails;
        window.exportToCSV = exportToCSV;
        window.exportToExcel = exportToExcel;
        window.exportToJSON = exportToJSON;
        window.importFromCSV = importFromCSV;
        window.importFromJSON = importFromJSON;
        window.refreshDashboard = refreshDashboard;
        window.showQuickStats = showQuickStats;
    </script>
</body>
</html>
